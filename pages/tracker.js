(function(k,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(k=typeof globalThis<"u"?globalThis:k||self,g(k.NajdPulseWidget={}))})(this,function(k){"use strict";var g=(t=>(t.PRODUCT_VIEWED="Product Viewed",t.PRODUCT_LIST_VIEWED="Product List Viewed",t.PRODUCT_ADDED="Product Added",t.PRODUCT_REMOVED="Product Removed",t.CART_VIEWED="Cart Viewed",t.CHECKOUT_STARTED="Checkout Started",t.CHECKOUT_STEP_VIEWED="Checkout Step Viewed",t.CHECKOUT_STEP_COMPLETED="Checkout Step Completed",t.PAYMENT_INFO_ENTERED="Payment Info Entered",t.ORDER_COMPLETED="Order Completed",t.PRODUCT_CLICKED="Product Clicked",t.PRODUCT_SHARED="Product Shared",t.PRODUCT_REVIEWED="Product Reviewed",t.PRODUCTS_SEARCHED="Products Searched",t.PROMOTION_VIEWED="Promotion Viewed",t.PROMOTION_CLICKED="Promotion Clicked",t.COUPON_ENTERED="Coupon Entered",t.COUPON_APPLIED="Coupon Applied",t.COUPON_DENIED="Coupon Denied",t.COUPON_REMOVED="Coupon Removed",t.WISHLIST_PRODUCT_ADDED="Wishlist Product Added",t.WISHLIST_PRODUCT_REMOVED="Wishlist Product Removed",t))(g||{});const W=[{id:"qa_product_help",enabled:!0,titleAr:"ÿ£ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®",titleEn:"Help me choose the right product",messageAr:"ÿ£ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑŸä",messageEn:"I need help choosing the right product for me",icon:"üõçÔ∏è",showOnPages:["all"],sortOrder:1},{id:"qa_product_specs",enabled:!0,titleAr:"ÿ£ÿ±ŸäÿØ ŸÖÿπÿ±ŸÅÿ© ŸÖŸàÿßÿµŸÅÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨",titleEn:"Tell me about product specifications",messageAr:"ÿ£ÿ±ŸäÿØ ŸÖÿπÿ±ŸÅÿ© ÿßŸÑŸÖÿ≤ŸäÿØ ÿπŸÜ ŸÖŸàÿßÿµŸÅÿßÿ™ ŸàŸÖŸÖŸäÿ≤ÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨",messageEn:"I want to learn more about this product's specifications and features",icon:"üìã",showOnPages:["product"],sortOrder:2},{id:"qa_offers",enabled:!0,titleAr:"ŸáŸÑ ŸäŸàÿ¨ÿØ ÿÆÿµŸÖ ÿ£Ÿà ÿπÿ±Ÿàÿ∂ ÿ≠ÿßŸÑŸäÿßŸãÿü",titleEn:"Are there any current discounts or offers?",messageAr:"ŸáŸÑ ŸäŸàÿ¨ÿØ ÿÆÿµŸÖ ÿ£Ÿà ÿπÿ±Ÿàÿ∂ ÿÆÿßÿµÿ© ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸãÿü",messageEn:"Are there any discounts or special offers available now?",icon:"üéÅ",showOnPages:["all"],sortOrder:3},{id:"qa_order_tracking",enabled:!0,titleAr:"ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ∑ŸÑÿ® Ÿàÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ",titleEn:"Order tracking and return policy",messageAr:"ÿ£ÿ±ŸäÿØ ŸÖÿπÿ±ŸÅÿ© ŸÉŸäŸÅŸäÿ© ÿ™ÿ™ÿ®ÿπ ÿ∑ŸÑÿ®Ÿä ŸàŸÖÿßŸáŸä ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπÿü",messageEn:"How can I track my order and what is your return policy?",icon:"üì¶",showOnPages:["all"],sortOrder:4}],te=[{id:"sug_best_match",enabled:!0,icon:"sparkles",labelAr:"ÿßŸÇÿ™ÿ±ÿ≠ ŸÑŸä ÿßŸÑÿ£ŸÜÿ≥ÿ®",labelEn:"Suggest the Best",messageAr:"ÿ£ŸÇÿ™ÿ±ÿ≠ ŸÑŸä ÿ£ŸÅÿ∂ŸÑ ÿÆŸäÿßÿ± ÿ≠ÿ≥ÿ® ÿßÿ≠ÿ™Ÿäÿßÿ¨Ÿä ŸàŸÖŸäÿ≤ÿßŸÜŸäÿ™Ÿä.",messageEn:"Suggest the best option based on my needs and budget.",showOnPages:["all"],priority:100,sortOrder:1},{id:"sug_full_specs",enabled:!0,icon:"clipboard",labelAr:"ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ ŸÉÿßŸÖŸÑÿ©",labelEn:"Full Specifications",messageAr:"ÿßÿ∞ŸÉÿ± ŸÑŸä ŸÖŸàÿßÿµŸÅÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ®ÿ¥ŸÉŸÑ ŸÖÿÆÿ™ÿµÿ± ŸàŸàÿßÿ∂ÿ≠.",messageEn:"Tell me the product specifications concisely and clearly.",showOnPages:["product"],whenEvents:["PRODUCT_VIEWED"],priority:90,sortOrder:2},{id:"sug_shipping",enabled:!0,icon:"truck",labelAr:"ÿßŸÑÿ¥ÿ≠ŸÜ ŸàÿßŸÑÿ™ŸàÿµŸäŸÑ",labelEn:"Shipping & Delivery",messageAr:"ŸÉŸÖ ŸÖÿØÿ© ÿßŸÑÿ¥ÿ≠ŸÜÿü ŸàŸáŸÑ ŸäŸàÿ¨ÿØ ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπÿü",messageEn:"How long is shipping? Is express delivery available?",showOnPages:["all"],priority:80,sortOrder:3},{id:"sug_warranty",enabled:!0,icon:"shield",labelAr:"ÿßŸÑÿ∂ŸÖÿßŸÜ ŸàÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ",labelEn:"Warranty & Returns",messageAr:"ŸÖÿß ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ŸàÿßŸÑÿ∂ŸÖÿßŸÜÿü",messageEn:"What is your return and warranty policy?",showOnPages:["all"],priority:70,sortOrder:4},{id:"sug_compare",enabled:!0,icon:"scales",labelAr:"ŸÇÿßÿ±ŸÜ ŸÖÿπ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ©",labelEn:"Compare Similar Products",messageAr:"ŸÇÿßÿ±ŸÜ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖÿπ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ©.",messageEn:"Compare this product with similar alternatives.",showOnPages:["product"],whenEvents:["PRODUCT_VIEWED"],priority:75,sortOrder:5},{id:"sug_discount",enabled:!0,icon:"tag",labelAr:"ŸáŸÑ ŸäŸàÿ¨ÿØ ÿÆÿµŸÖÿü",labelEn:"Any Discounts?",messageAr:"ŸáŸÑ ŸäŸàÿ¨ÿØ ŸÉŸàÿØ ÿÆÿµŸÖ ÿ£Ÿà ÿπÿ±ÿ∂ ÿÆÿßÿµÿü",messageEn:"Is there a discount code or special offer?",showOnPages:["all"],priority:85,sortOrder:6}],N={enabled:!0,maxVisible:3,style:"chips",items:te};function Te(t,e,o=!1){var n,i,r;return{enabled:t.enabled,apiBaseUrl:e,storeId:t.storeId,botName:t.identity.name,botAvatar:t.identity.avatarUrl,primaryColor:t.styling.primaryColor,accentColor:t.styling.accentColor,themeMode:t.styling.themeMode,position:t.behavior.position,locale:"auto",greetingAr:t.identity.greetingAr,greetingEn:t.identity.greetingEn,tone:t.identity.tone,enabledPages:t.behavior.enabledPages,quietModeInCheckout:t.behavior.quietModeInCheckout,autoMessageCooldownMs:t.behavior.autoMessageCooldownMs,maxAutoMessagesPerPage:t.behavior.maxAutoMessagesPerPage,proactiveRules:t.behavior.proactiveRules,autoOpenEnabled:t.behavior.autoOpenEnabled??!0,autoOpenDelayMs:t.behavior.autoOpenDelayMs??6e3,showWelcomeOnLauncherTap:t.behavior.showWelcomeOnLauncherTap??!0,quickActions:(n=t.behavior.quickActions)!=null&&n.length?t.behavior.quickActions:W,suggestions:(r=(i=t.behavior.suggestions)==null?void 0:i.items)!=null&&r.length?t.behavior.suggestions:N,handoff:t.handoff,businessHours:t.businessHours,debugMode:o}}const Se=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_QUICK_ACTIONS:W,DEFAULT_SUGGESTIONS:te,DEFAULT_SUGGESTIONS_CONFIG:N,transformBotConfig:Te},Symbol.toStringTag,{value:"Module"})),Ce=200;function C(t){if(typeof t!="string")return;const e=t.trim();if(!(e.length===0||e.length>Ce)&&!(e.includes("{{")||e.includes("}}")))return e}function D(){try{const t=window.__NAJDPULSE_CONTEXT__;if(!t||typeof t!="object")return;const e={};if(t.store&&typeof t.store=="object"){const o={},n=C(t.store.id);n&&(o.id=n);const i=C(t.store.domain);i&&(o.domain=i);const r=C(t.store.username);r&&(o.username=r),Object.keys(o).length>0&&(e.store=o)}if(t.customer&&typeof t.customer=="object"){const o={},n=C(t.customer.id);n&&(o.id=n);const i=C(t.customer.name);i&&(o.name=i),Object.keys(o).length>0&&(e.customer=o)}return Object.keys(e).length>0?e:void 0}catch{return}}function A(){var e;const t=D();return(e=t==null?void 0:t.store)!=null&&e.domain?t.store.domain:window.location.hostname}function De(){var e,o,n,i;const t=D();if((e=t==null?void 0:t.store)!=null&&e.id)return t.store.id;try{if((i=(n=(o=window.Salla)==null?void 0:o.config)==null?void 0:n.store)!=null&&i.id)return window.Salla.config.store.id}catch{}}let h={...{enabled:!0,apiBaseUrl:"",storeId:"",botName:"ŸÖÿ≥ÿßÿπÿØ ÿßŸÑŸÖÿ™ÿ¨ÿ±",primaryColor:"#6366F1",accentColor:"#10B981",themeMode:"auto",position:"bottom-right",locale:"auto",greetingAr:"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü",greetingEn:"Hello! How can I help you today?",tone:"balanced",enabledPages:["home","product","category","cart","other"],quietModeInCheckout:!0,autoMessageCooldownMs:25e3,debugMode:!1,maxAutoMessagesPerPage:2,autoOpenEnabled:!0,autoOpenDelayMs:6e3,showWelcomeOnLauncherTap:!0,quickActions:W,suggestions:N}};function Ae(){const t=new URLSearchParams(window.location.search);(t.get("np_debug")==="true"||t.get("widget_debug")==="1"||t.get("debug")==="true")&&(h.debugMode=!0);try{window.__NAJDPULSE_DEBUG__===!0&&(h.debugMode=!0)}catch{}h.debugMode&&console.log("[Widget Debug] Debug mode enabled");try{const e=De();e&&(h.storeId=e,h.debugMode&&console.log("[Widget Debug] Store ID detected:",h.storeId))}catch(e){h.debugMode&&console.warn("[Widget Debug] Could not detect store ID:",e)}if(h.debugMode){const e=D();e&&console.log("[Widget Debug] Snippet context:",e)}try{const e=document.documentElement.lang;e!=null&&e.startsWith("ar")?h.locale="ar":e!=null&&e.startsWith("en")&&(h.locale="en"),h.debugMode&&console.log("[Widget Debug] Locale detected:",h.locale)}catch(e){console.warn("[Widget] Could not detect locale:",e)}}function Me(t){h={...h,...t},h.debugMode&&(console.log("[Widget Debug] Config updated:",h),console.log("[Widget Debug] Suggestions config:",h.suggestions))}function l(){return h}function _e(t){const e=l();if(!e.enabled)return!1;if(e.enabledPages.includes("all"))return e.debugMode&&console.log("[Widget Debug] Widget enabled on all pages"),!0;const o=e.enabledPages.includes(t);return e.debugMode&&console.log(`[Widget Debug] Page ${t} enabled: ${o}`,e.enabledPages),o}function Ie(t){return l().quietModeInCheckout&&t==="checkout"}let u={pageType:"other",currentProduct:null,currentCategory:null,cartSummary:null,customer:{isLoggedIn:!1,firstName:void 0,id:void 0},lastEvents:[],locale:"en",direction:"ltr",storeId:""};const oe=10;function x(){return{...u}}function M(t){u.pageType!==t&&(u.pageType=t,t!=="product"&&(u.currentProduct=null),t!=="category"&&(u.currentCategory=null),T("Page type updated:",t))}function Pe(){const t=window.location.pathname.toLowerCase();return t==="/"||t.includes("/home")?"home":t.includes("/product")||t.includes("/products/")?"product":t.includes("/categor")||t.includes("/collection")?"category":t.includes("/cart")?"cart":t.includes("/checkout")?"checkout":"other"}function Oe(){return u.currentProduct?{...u.currentProduct}:null}function Re(t){u.currentProduct=t,t&&(u.pageType="product",T("Product context updated:",t))}function Le(t){u.currentCategory=t,t&&(u.pageType="category",T("Category context updated:",t))}function U(t){u.cartSummary=t,T("Cart summary updated:",t)}function v(t){u.lastEvents.unshift({name:t,timestamp:Date.now()}),u.lastEvents.length>oe&&(u.lastEvents=u.lastEvents.slice(0,oe))}function We(t){u.locale=t}function $(t){u.customer={...u.customer,...t},T("Customer context updated:",u.customer)}function Ne(){const t=l();u.pageType=Pe();try{const{detectLocale:e}=require("./locale"),o=e();u.locale=o.locale,u.direction=o.direction}catch{if(t.locale==="auto"){const o=document.documentElement.lang;u.locale=o!=null&&o.startsWith("ar")?"ar":"en",u.direction=o!=null&&o.startsWith("ar")?"rtl":"ltr"}else u.locale=t.locale,u.direction=t.locale==="ar"?"rtl":"ltr"}u.storeId=t.storeId,T("Context initialized:",u)}function Ue(t){try{if(!t)return null;const e=t.product||t;return{id:e.id||e.product_id,name:e.name,price:e.price,currency:e.currency,url:e.url,imageUrl:e.image_url||e.image,category:e.category,sku:e.sku}}catch(e){return console.warn("[Widget] Error extracting product from payload:",e),null}}function q(t){var e,o;try{if(!t)return null;const n=t.cart||t;return{itemCount:n.item_count||((e=n.items)==null?void 0:e.length)||0,total:n.total||n.value,currency:n.currency,items:(o=n.items)==null?void 0:o.map(i=>({productId:i.product_id||i.id,name:i.name,quantity:i.quantity,price:i.price}))}}catch(n){return console.warn("[Widget] Error extracting cart from payload:",n),null}}function $e(t){var e;try{if(!t)return null;const o=t.category||t;return{id:o.id||o.category_id,name:o.name,productsCount:o.products_count||((e=t.products)==null?void 0:e.length)}}catch(o){return console.warn("[Widget] Error extracting category from payload:",o),null}}function T(t,e){l().debugMode&&console.log(`[Widget Debug] ${t}`,e)}const ne=g.CART_UPDATED,qe=t=>{console.log("CART UPDATED Event:",t);const e=q(t);e&&U(e),v(ne)};function He(t){if(l().debugMode&&console.log("[Smart Messages] Generating message for:",t.event,t),t.event==="product.viewed"&&t.product){const o=[`ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸáŸÑ ÿ™ÿ®ÿ≠ÿ´ ÿπŸÜ ${t.product.name}ÿü ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿßÿ™ÿÆÿßÿ∞ ÿßŸÑŸÇÿ±ÿßÿ±! üõçÔ∏è`,`ÿ£ÿ±Ÿâ ÿ£ŸÜŸÉ ÿ™ÿ™ÿµŸÅÿ≠ ${t.product.name}. ŸáŸÑ ŸÑÿØŸäŸÉ ÿ£Ÿä ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≠ŸàŸÑŸáÿü üí¨`,`${t.product.name} ŸÖŸÜ ÿ£ŸÉÿ´ÿ± ŸÖŸÜÿ™ÿ¨ÿßÿ™ŸÜÿß ÿ¥ÿπÿ®Ÿäÿ©! ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©ÿü ‚ú®`];return o[Math.floor(Math.random()*o.length)]}if(t.event==="product.added"&&t.product){const o=[`ÿ±ÿßÿ¶ÿπ! ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${t.product.name} ÿ•ŸÑŸâ ÿ≥ŸÑÿ™ŸÉ üéâ ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ±ÿ§Ÿäÿ© ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ©ÿü`,`ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÖÿ™ÿßÿ≤! ${t.product.name} ŸÅŸä ÿ≥ŸÑÿ™ŸÉ ÿßŸÑÿ¢ŸÜ üõí ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®ÿü`,`ÿ™ŸÖ! ${t.product.name} ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ¥ÿ±ÿßÿ° üíö ŸáŸÑ ÿ™ÿ≠ÿ® ÿ£ŸÜ ÿ£ŸÇÿ™ÿ±ÿ≠ ÿπŸÑŸäŸÉ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ™ŸÉŸÖŸäŸÑŸäÿ©ÿü`];return o[Math.floor(Math.random()*o.length)]}if(t.event==="cart.viewed"&&t.cart){if(t.cart.itemCount===0)return"ÿ≥ŸÑÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ© ÿ≠ÿßŸÑŸäÿßŸã üõí ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿß ÿ™ÿ®ÿ≠ÿ´ ÿπŸÜŸáÿü";const o=[`ŸÑÿØŸäŸÉ ${t.cart.itemCount} ŸÖŸÜÿ™ÿ¨ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©! üéÅ ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ≥ÿ™ÿπÿØ ŸÑÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®ÿü`,`ÿ≥ŸÑÿ™ŸÉ ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ${t.cart.itemCount} ŸÖŸÜÿ™ÿ¨ ÿ±ÿßÿ¶ÿπ! üí´ ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ±ŸÖÿ≤ ÿÆÿµŸÖÿü`,`ÿ™ŸÇÿ±Ÿäÿ®ÿßŸã ÿ¨ÿßŸáÿ≤! ${t.cart.itemCount} ŸÖŸÜÿ™ÿ¨ ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ±ŸÉ üöÄ ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ©ÿü`];return o[Math.floor(Math.random()*o.length)]}if(t.event==="checkout.started"){const o=["ÿπÿ∏ŸäŸÖ! ÿ£ŸÜÿ™ ÿπŸÑŸâ Ÿàÿ¥ŸÉ ÿ•ÿ™ŸÖÿßŸÖ ÿ∑ŸÑÿ®ŸÉ üéâ ÿ•ÿ∞ÿß Ÿàÿßÿ¨Ÿáÿ™ ÿ£Ÿä ŸÖÿ¥ŸÉŸÑÿ©ÿå ÿ£ŸÜÿß ŸáŸÜÿß ŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©!","ÿ™ŸáÿßŸÜŸäŸÜÿß ÿπŸÑŸâ ŸàÿµŸàŸÑŸÉ ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿØŸÅÿπ! üí≥ ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿ•ŸÉŸÖÿßŸÑ ÿ∑ŸÑÿ®ŸÉÿü","ÿ£ŸÜÿ™ ŸÅŸä ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©! ‚ú® ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÑÿØŸäŸÉ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿπŸÜ ÿßŸÑÿ¥ÿ≠ŸÜ ÿ£Ÿà ÿßŸÑÿØŸÅÿπÿå ÿßÿ≥ÿ£ŸÑŸÜŸä!"];return o[Math.floor(Math.random()*o.length)]}if(t.event==="product.removed"&&t.product){const o=[`ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ${t.product.name} ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ±ÿ§Ÿäÿ© ÿ®ÿØÿßÿ¶ŸÑ ŸÖÿ¥ÿßÿ®Ÿáÿ©ÿü üîÑ`,`ŸÑÿß ŸÖÿ¥ŸÉŸÑÿ©! ÿ•ÿ∞ÿß ÿ∫Ÿäÿ±ÿ™ ÿ±ÿ£ŸäŸÉ ÿπŸÜ ${t.product.name}ÿå ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿ•Ÿäÿ¨ÿßÿØ ÿ¥Ÿäÿ° ÿ£ŸÅÿ∂ŸÑ üí°`,`ŸÅŸáŸÖÿ™! ŸáŸÑ ÿ™ÿ±ÿ∫ÿ® ŸÅŸä ÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ£ÿÆÿ±Ÿâ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ${t.product.name}ÿü üîç`];return o[Math.floor(Math.random()*o.length)]}return t.event==="user.signed_in"?"ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉ! üëã ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü":t.event==="products.searched"?"ÿ£ÿ±Ÿâ ÿ£ŸÜŸÉ ÿ™ÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¥Ÿäÿ° ŸÖÿ≠ÿØÿØ! üîç ŸáŸÑ Ÿàÿ¨ÿØÿ™ ŸÖÿß ÿ™ÿ±ŸäÿØ ÿ£ŸÖ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ©ÿü":null}function H(t){const e=He(t);if(!e)return;l().debugMode&&console.log("[Smart Messages] Sending:",e);const n=new CustomEvent("najdpulse:auto-message",{detail:{message:e,context:t}});window.dispatchEvent(n)}const ie=g.CART_VIEWED,ze=t=>{console.log("CART VIEWED Event:",t),M("cart");const e=q(t);e&&U(e),v(ie),e&&H({event:"cart.viewed",cart:{itemCount:e.itemCount,total:e.total},pageType:"cart"})},re=g.CHECKOUT_STARTED,Ve=t=>{console.log("CHECKOUT STARTED Event:",t),M("checkout"),v(re)},ae=g.PRODUCT_ADDED,je=t=>{console.log("PRODUCT ADDED Event:",t);const e=q(t);e&&U(e),v(ae);const o=Oe();o&&H({event:"product.added",product:{id:o.id,name:o.name,price:o.price,category:o.category},cart:e||void 0,pageType:"product"})},E={PRODUCT_VIEWED:"PRODUCT_VIEWED",PRODUCT_LIST_VIEWED:"PRODUCT_LIST_VIEWED",PRODUCT_ADDED:"PRODUCT_ADDED",PRODUCT_REMOVED:"PRODUCT_REMOVED",PRODUCT_CLICKED:"PRODUCT_CLICKED",PRODUCT_REVIEWED:"PRODUCT_REVIEWED",PRODUCT_SHARED:"PRODUCT_SHARED",PRODUCTS_SEARCHED:"PRODUCTS_SEARCHED",CART_VIEWED:"CART_VIEWED",CART_UPDATED:"CART_UPDATED",CHECKOUT_STARTED:"CHECKOUT_STARTED",CHECKOUT_STEP_VIEWED:"CHECKOUT_STEP_VIEWED",CHECKOUT_STEP_COMPLETED:"CHECKOUT_STEP_COMPLETED",PAYMENT_INFO_ENTERED:"PAYMENT_INFO_ENTERED",ORDER_COMPLETED:"ORDER_COMPLETED",SIGNED_IN:"SIGNED_IN",SIGNED_OUT:"SIGNED_OUT",SIGNED_UP:"SIGNED_UP",USER_PROFILE_UPDATED:"USER_PROFILE_UPDATED",COUPON_ENTERED:"COUPON_ENTERED",COUPON_APPLIED:"COUPON_APPLIED",COUPON_DENIED:"COUPON_DENIED",COUPON_REMOVED:"COUPON_REMOVED",WISHLIST_PRODUCT_ADDED:"WISHLIST_PRODUCT_ADDED",WISHLIST_PRODUCT_REMOVED:"WISHLIST_PRODUCT_REMOVED",WISHLIST_PRODUCT_ADDED_TO_CART:"WISHLIST_PRODUCT_ADDED_TO_CART",PROMOTION_VIEWED:"PROMOTION_VIEWED",PROMOTION_CLICKED:"PROMOTION_CLICKED",PRODUCT_LIST_FILTERED:"PRODUCT_LIST_FILTERED",HOME_VIEWED:"HOME_VIEWED"};function z(t){if(!t)return"";const e=t.toUpperCase().replace(/[\s.-]+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");return e in E,e}let _=null;function Ke(t){_=t}function P(t,e){const o=l();if(!_||!_e(t))return;if(Ie(t)){o.debugMode&&console.log("[Widget Debug] Quiet mode - no auto-message");return}const n=o.locale==="ar",{message:i,quickReplies:r}=Ge(t,e,n);i&&_&&(typeof _.sendAutoMessage=="function"?_.sendAutoMessage(i,r):o.debugMode&&(console.warn("[Widget Debug] sendAutoMessage method not available on widget instance"),console.log("[Widget Debug] Message would be:",i)))}function Ge(t,e,o){var r,a;const n=x(),i=z(e||"");switch(t){case"home":if(i===E.SIGNED_IN){const s=n.customer.firstName||(o?"ÿßŸÑÿπŸÖŸäŸÑ":"there");return{message:o?`ÿ£ŸáŸÑÿßŸã ${s}! ÿ≥ÿπŸäÿØ ÿ®ÿπŸàÿØÿ™ŸÉ. ŸÉŸäŸÅ ÿ£ŸÇÿØÿ± ÿ£ÿ≥ÿßÿπÿØŸÉ ÿßŸÑŸäŸàŸÖÿü üòä`:`Welcome back, ${s}! How can I help you today? üòä`,quickReplies:o?["ÿ•ŸÉŸÖÿßŸÑ ÿ∑ŸÑÿ®Ÿä ÿßŸÑÿ≥ÿßÿ®ŸÇ","ÿßŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑÿÆÿßÿµÿ©","ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ¨ÿØŸäÿØÿ©","ÿ∑ŸÑÿ®ÿßÿ™Ÿä"]:["Continue shopping","Special offers","New arrivals","My orders"]}}else if(i===E.SIGNED_UP){const s=n.customer.firstName||(o?"ÿßŸÑÿπŸÖŸäŸÑ":"there");return{message:o?`ŸÖÿ±ÿ≠ÿ®ÿßŸã ${s}! ÿ≥ÿπŸäÿØ ÿ®ÿßŸÜÿ∂ŸÖÿßŸÖŸÉ ŸÑŸÖÿ™ÿ¨ÿ±ŸÜÿß. ÿπŸÜ ŸÖÿßÿ∞ÿß ÿ™ÿ®ÿ≠ÿ´ÿü üéâ`:`Welcome ${s}! Great to have you join us. What are you looking for? üéâ`,quickReplies:o?["ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™","ÿßŸÑÿπÿ±Ÿàÿ∂ ÿßŸÑŸÖŸÖŸäÿ≤ÿ©","ÿßŸÑÿ£ŸÉÿ´ÿ± ŸÖÿ®ŸäÿπÿßŸã","ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß"]:["Browse products","Special deals","Best sellers","Contact us"]}}else{if(i===E.SIGNED_OUT)return{message:o?"ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨. ÿ™ŸÇÿØÿ± ÿ™ŸÉŸÖŸÑ ÿßŸÑÿ™ÿµŸÅÿ≠ ÿ£Ÿà ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÉÿ≤ÿßÿ¶ÿ± üëã":"You're now signed out. Feel free to continue browsing or shopping as a guest üëã",quickReplies:o?["ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™","ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ","ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®"]:["Browse products","Sign in","Create account"]};if(i===E.USER_PROFILE_UPDATED)return{message:o?"ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸä ÿ®ŸÜÿ¨ÿßÿ≠. ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ŸÜÿß ÿ≥ÿ™ÿ™ŸÉŸäŸÅ ŸÖÿπ ÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ŸÉ ‚úì":"Profile updated successfully. Our recommendations will adapt to your preferences ‚úì",quickReplies:o?["ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ŸÑŸä","ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©","ÿ™ÿµŸÅÿ≠ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™"]:["Recommendations","Favorites","Browse products"]}}return{message:o?"ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã! ÿ£ŸÇÿØÿ± ÿ£ÿ≥ÿßÿπÿØŸÉ ŸÅŸä ÿ•Ÿäÿ¨ÿßÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ÿ£Ÿà ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ£Ÿä ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ± üòä":"Welcome! I can help you find products or answer any questions üòä",quickReplies:o?["ÿ¥ÿ≠ŸÜ Ÿàÿ™ŸàÿµŸäŸÑ","ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ","ÿπÿ±Ÿàÿ∂ ÿÆÿßÿµÿ©","ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß"]:["Shipping","Returns","Special offers","Contact us"]};case"product":if(i===E.PRODUCT_VIEWED){const s=((r=n.currentProduct)==null?void 0:r.name)||"ÿßŸÑŸÖŸÜÿ™ÿ¨";return{message:o?`ÿ¥ŸÅÿ™ ${s}! ÿ™ÿ®ÿ∫Ÿâ ÿ£ŸÑÿÆÿµ ŸÑŸÉ ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ ÿ£Ÿà ÿ™ŸÇÿßÿ±ŸÜŸá ÿ®ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ´ÿßŸÜŸäÿ©ÿü üõçÔ∏è`:`Looking at ${s}! Want a specs summary or comparison? üõçÔ∏è`,quickReplies:o?["ŸÑÿÆÿµ ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™","ŸÇÿßÿ±ŸÜ ŸÖÿπ ŸÖŸÜÿ™ÿ¨ÿßÿ™","ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ","ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¥ÿßÿ¶ÿπÿ©"]:["Summarize specs","Compare","Return policy","FAQs"]}}break;case"category":if(i===E.PRODUCT_LIST_VIEWED)return{message:o?"ÿ£ŸÇÿØÿ± ÿ£ÿ≥ÿßÿπÿØŸÉ ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ÿ≠ÿ≥ÿ® ÿßÿ≠ÿ™Ÿäÿßÿ¨ŸÉ ŸàŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ üéØ":"I can help you pick the right product based on your needs and budget üéØ",quickReplies:o?["ÿßŸÇÿ™ÿ±ÿ≠ ŸÖŸÜÿ™ÿ¨ÿßÿ™","ŸÖÿß ÿßŸÑÿ£ŸÅÿ∂ŸÑÿü","ÿßŸÑÿ£ÿπŸÑŸâ ÿ™ŸÇŸäŸäŸÖÿßŸã","ŸÇÿßÿ±ŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™"]:["Suggest products","Best choice?","Top rated","Compare"]};break;case"cart":if(e.includes("PRODUCT_ADDED"))return{message:o?"ŸÖŸÖÿ™ÿßÿ≤! ÿ™ÿ®ÿ∫Ÿâ ÿ£ŸÇÿ™ÿ±ÿ≠ ÿπŸÑŸäŸÉ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÉŸÖŸÑÿ© ÿ£Ÿà ÿ£ÿ≥ÿßÿπÿØŸÉ ÿ®ŸÉŸàÿØ ÿÆÿµŸÖÿü üõí":"Great! Want product suggestions or help with a discount code? üõí",quickReplies:o?["ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÉŸÖŸÑÿ©","ŸÉŸàÿØ ÿÆÿµŸÖ","ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ¥ÿ≠ŸÜ","ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®"]:["Add-ons","Discount code","Shipping cost","Checkout"]};if(e.includes("CART_VIEWED")){const s=((a=n.cartSummary)==null?void 0:a.itemCount)||0;return{message:o?`ÿπŸÜÿØŸÉ ${s} ŸÖŸÜÿ™ÿ¨ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©. ÿ™ÿ®ÿ∫Ÿâ ŸÖÿ≥ÿßÿπÿØÿ© ŸÇÿ®ŸÑ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®ÿü ‚úì`:`You have ${s} item${s!==1?"s":""} in cart. Need help before checkout? ‚úì`,quickReplies:o?["ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ¥ÿ≠ŸÜ","ŸÉŸàÿØ ÿÆÿµŸÖ","ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπ","ÿ£ŸÉŸÖŸÑ ÿßŸÑÿ∑ŸÑÿ®"]:["Shipping info","Discount","Returns","Continue"]}}break;case"checkout":return{message:""}}return{message:o?"ÿ£ŸÜÿß ŸáŸÜÿß ÿ•ÿ∞ÿß ÿßÿ≠ÿ™ÿ¨ÿ™ ŸÖÿ≥ÿßÿπÿØÿ©! üòä":"I'm here if you need help! üòä",quickReplies:o?["ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©","ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß"]:["FAQs","Contact us"]}}const V=g.PRODUCT_LIST_VIEWED,Be=t=>{console.log("PRODUCT LIST VIEWED Event:",t),M("category");const e=$e(t);e&&Le(e),v(V),P("category",V)},se=g.PRODUCT_VIEWED,Fe=t=>{console.log("PRODUCT VIEWED Event:",t),M("product");const e=Ue(t);e&&Re(e),v(se),e&&H({event:"product.viewed",product:{id:e.id,name:e.name,price:e.price,category:e.category},pageType:"product"})},j=g.SIGNED_IN,Ye=t=>{console.log("SIGNED IN Event:",t),$({isLoggedIn:!0,firstName:t.first_name||t.name,id:t.customer_id||t.id}),v(j),P("home",j)},K=g.SIGNED_UP,Qe=t=>{console.log("SIGNED UP Event:",t),$({isLoggedIn:!0,firstName:t.first_name||t.name,id:t.customer_id||t.id}),v(K),P("home",K)},G=g.USER_PROFILE_UPDATED,Je=t=>{console.log("USER PROFILE UPDATED Event:",t),(t.first_name||t.name)&&$({firstName:t.first_name||t.name}),v(G),P("home",G)},f=new Map;f.set(ne,qe),f.set(ie,ze),f.set(re,Ve),f.set(ae,je),f.set(V,Be),f.set(se,Fe),f.set(j,Ye),f.set(K,Qe),f.set(G,Je);const ce=1e4,le=2,de=1e3;function ue(t,e,o){return Promise.race([fetch(t,e),new Promise((n,i)=>setTimeout(()=>i(new Error("Request timeout")),o))])}async function Xe(t,e={}){const{timeout:o=ce,retries:n=le,retryDelay:i=de,debugMode:r=!1}=e;let a=null;for(let s=0;s<=n;s++){try{r&&s>0&&console.log(`[Network] Retry attempt ${s} for ${t}`);const c=await ue(t,{method:"GET",headers:{"Content-Type":"application/json"}},o);if(c.ok)return c;if(c.status===404)return r&&console.log(`[Network] 404 Not Found for ${t} - not retrying`),c;a=new Error(`HTTP ${c.status}: ${c.statusText}`),r&&console.warn(`[Network] Request failed with status ${c.status}`)}catch(c){a=c,r&&console.warn("[Network] Request error:",c)}s<n&&await new Promise(c=>setTimeout(c,i))}return r&&console.error(`[Network] All ${n+1} attempts failed for ${t}:`,a),null}async function Ze(t,e,o={}){const{timeout:n=ce,retries:i=le,retryDelay:r=de,debugMode:a=!1}=o;let s=null;for(let c=0;c<=i;c++){try{a&&c>0&&console.log(`[Network] Retry attempt ${c} for ${t}`);const d=await ue(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},n);if(d.ok)return d;if(d.status===400||d.status===404)return a&&console.log(`[Network] ${d.status} for ${t} - not retrying`),d;s=new Error(`HTTP ${d.status}: ${d.statusText}`),a&&console.warn(`[Network] Request failed with status ${d.status}`)}catch(d){s=d,a&&console.warn("[Network] Request error:",d)}c<i&&await new Promise(d=>setTimeout(d,r))}return a&&console.error(`[Network] All ${i+1} attempts failed for ${t}:`,s),null}let O=null,ge=0;const et=10*60*1e3;async function tt(t="",e=!1){var o;try{const n=Date.now();if(O&&n-ge<et)return e&&console.log("[Widget Config] Using cached config"),O;const i=A(),r=`${t}/public/widget/config?domain=${encodeURIComponent(i)}`;e&&console.log("[Widget Config] Fetching config from:",r);const a=await Xe(r,{timeout:1e4,retries:2,retryDelay:1e3,debugMode:e});if(!a)return e&&console.warn("[Widget Config] All fetch attempts failed"),null;if(!a.ok)return a.status===404?(e&&console.log("[Widget Config] Store not configured (404)"),null):(e&&console.warn(`[Widget Config] HTTP ${a.status}: ${a.statusText}`),null);const s=await a.json();return!s.storeId||!((o=s.identity)!=null&&o.name)?(e&&console.warn("[Widget Config] Invalid config structure, missing required fields"),null):(O=s,ge=n,e&&console.log("[Widget Config] ‚úÖ Config loaded successfully:",{storeId:s.storeId,botName:s.identity.name,enabled:s.enabled}),O)}catch(n){return e&&console.warn("[Widget Config] Error fetching config:",n),null}}function ot(t,e,o=!1){if(!t){o&&console.warn("[Widget Branding] No widget element provided");return}try{t.style.setProperty("--np-primary",e.primaryColor),t.style.setProperty("--np-accent",e.accentColor),t.style.setProperty("--primary-color",e.primaryColor),t.setAttribute("data-bot-name",e.botName),o&&console.log("[Widget Branding] Applied to element:",{primaryColor:e.primaryColor,accentColor:e.accentColor,botName:e.botName})}catch(n){o&&console.error("[Widget Branding] Error applying branding:",n)}}const pe="salla_widget_session",nt=7;function it(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function rt(){try{const t=localStorage.getItem(pe);if(t){const e=JSON.parse(t);if(e.expiresAt>Date.now())return e.id}}catch(t){console.warn("[Widget] Error reading session from localStorage:",t)}return at()}function at(){const t=it(),e=Date.now(),o={id:t,createdAt:e,expiresAt:e+nt*24*60*60*1e3};try{localStorage.setItem(pe,JSON.stringify(o))}catch(n){console.warn("[Widget] Error saving session to localStorage:",n)}return t}const B="najdpulse_chat_history",he=12;function st(){try{const t=localStorage.getItem(B);if(t)return JSON.parse(t).slice(-he)}catch(t){console.warn("[Chat] Error reading chat history:",t)}return[]}function me(t,e){try{const o=st();o.push({role:t,content:e,timestamp:Date.now()});const n=o.slice(-he);localStorage.setItem(B,JSON.stringify(n))}catch(o){console.warn("[Chat] Error saving chat history:",o)}}function ct(){try{localStorage.removeItem(B)}catch(t){console.warn("[Chat] Error clearing chat history:",t)}}async function fe(t,e="auto",o="rtl"){const n=l(),i=x(),r=rt(),a=A(),c=`${n.apiBaseUrl||window.__NAJDPULSE_API_URL__||""}/public/chat/respond`;n.debugMode&&console.log("[Chat API] Sending message to backend:",c);try{const d=await Ze(c,{domain:a,sessionId:r,userMessage:t,context:{pageType:i.pageType,currentProduct:i.currentProduct,currentCategory:i.currentCategory,cartSummary:i.cartSummary,customer:i.customer,lastEvents:i.lastEvents},locale:e,dir:o,pageMode:i.pageType},{timeout:15e3,retries:1,retryDelay:500,debugMode:n.debugMode});if(!d||!d.ok)throw new Error(`API request failed: ${(d==null?void 0:d.status)||"no response"}`);const p=await d.json();return me("user",t),me("assistant",p.assistantMessage),n.debugMode&&console.log("[Chat API] Response received:",p),{assistantMessage:p.assistantMessage,quickReplies:p.quickReplies||[],action:p.action||null,pageMode:p.pageMode||null}}catch(d){return n.debugMode&&console.error("[Chat API] Error sending message:",d),{assistantMessage:e==="ar"||o==="rtl"?"ÿπÿ∞ÿ±ÿßŸãÿå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.":"Sorry, an error occurred. Please try again.",quickReplies:[]}}}let w={lastAutoMessageTime:0,autoMessagesThisPage:0,currentPageUrl:window.location.href};function lt(){const t=l(),e=Date.now();if(w.currentPageUrl!==window.location.href&&(w.currentPageUrl=window.location.href,w.autoMessagesThisPage=0,t.debugMode&&console.log("[Widget Debug] Page changed, resetting auto-message counter")),w.autoMessagesThisPage>=t.maxAutoMessagesPerPage)return t.debugMode&&console.log("[Widget Debug] Max auto-messages per page reached"),!1;const o=e-w.lastAutoMessageTime;return o<t.autoMessageCooldownMs?(t.debugMode&&console.log("[Widget Debug] Auto-message cooldown active:",{timeSinceLastMessage:o,cooldownMs:t.autoMessageCooldownMs}),!1):!0}function dt(){const t=l();w.lastAutoMessageTime=Date.now(),w.autoMessagesThisPage++,t.debugMode&&console.log("[Widget Debug] Auto-message recorded:",{count:w.autoMessagesThisPage,maxAllowed:t.maxAutoMessagesPerPage})}function F(){w.autoMessagesThisPage>1&&(w.autoMessagesThisPage=1)}const ut="salla_widget_locale_override";function b(){var n,i,r;const t=gt();if(t)return t;let e="en",o="ltr";try{const a=document.documentElement.getAttribute("lang");if(a){const s=a.toLowerCase();if(s.startsWith("ar"))return e="ar",o="rtl",{locale:e,direction:o};if(s.startsWith("en"))return e="en",o="ltr",{locale:e,direction:o}}}catch(a){console.warn("[Widget Locale] Error reading HTML lang:",a)}try{const a=document.documentElement.getAttribute("dir");if(a){const s=a.toLowerCase();if(s==="rtl")return e="ar",o="rtl",{locale:e,direction:o};if(s==="ltr")return e="en",o="ltr",{locale:e,direction:o}}}catch(a){console.warn("[Widget Locale] Error reading HTML dir:",a)}try{if(typeof window<"u"&&window.Salla){const a=((n=window.Salla.config)==null?void 0:n.locale)||((r=(i=window.Salla.config)==null?void 0:i.store)==null?void 0:r.locale)||window.Salla.locale;if(a){const s=a.toLowerCase();if(s.startsWith("ar")||s==="sa")return e="ar",o="rtl",{locale:e,direction:o};if(s.startsWith("en"))return e="en",o="ltr",{locale:e,direction:o}}}}catch(a){console.warn("[Widget Locale] Error reading Salla locale:",a)}try{const a=navigator.language.toLowerCase();if(a.startsWith("ar"))return e="ar",o="rtl",{locale:e,direction:o};if(a.startsWith("en"))return e="en",o="ltr",{locale:e,direction:o}}catch(a){console.warn("[Widget Locale] Error reading navigator.language:",a)}return{locale:e,direction:o}}function gt(){try{const t=localStorage.getItem(ut);if(t){const{locale:e,direction:o}=JSON.parse(t);if((e==="ar"||e==="en")&&(o==="rtl"||o==="ltr"))return{locale:e,direction:o}}}catch(t){console.warn("[Widget Locale] Error reading locale override:",t)}return null}class pt{constructor(e,o){this.timer=null,this.events=["mousemove","keydown","scroll","touchstart","pointerdown","click"],this.hasTriggered=!1,this.isActive=!1,this.delayMs=e,this.callback=o,this.boundResetTimer=this.resetTimer.bind(this)}start(){if(!this.isActive){if(this.isActive=!0,this.hasTriggered=!1,this.prefersReducedMotion()){console.log("[InactivityDetector] User prefers reduced motion, skipping auto-open");return}this.events.forEach(e=>{window.addEventListener(e,this.boundResetTimer,{passive:!0})}),this.resetTimer()}}stop(){this.isActive&&(this.isActive=!1,this.clearTimer(),this.events.forEach(e=>{window.removeEventListener(e,this.boundResetTimer)}))}resetTimer(){this.clearTimer(),!this.hasTriggered&&(this.timer=window.setTimeout(()=>{this.hasTriggered=!0,this.callback(),this.stop()},this.delayMs))}clearTimer(){this.timer!==null&&(window.clearTimeout(this.timer),this.timer=null)}prefersReducedMotion(){try{return window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch{return!1}}isTriggered(){return this.hasTriggered}destroy(){this.stop()}}const be="np_auto_open_shown",Y="np_widget_interacted",ht=24*60*60*1e3;function mt(){try{if(sessionStorage.getItem(Y)==="true")return!1;const e=localStorage.getItem(be);if(e){const o=parseInt(e,10);if(Date.now()-o<ht)return!1}return!0}catch(t){return console.warn("[AutoOpen] Error checking auto-open state:",t),!1}}function ft(){try{localStorage.setItem(be,Date.now().toString()),sessionStorage.setItem(Y,"true")}catch(t){console.warn("[AutoOpen] Error marking auto-open as shown:",t)}}function bt(){try{sessionStorage.setItem(Y,"true")}catch(t){console.warn("[AutoOpen] Error marking widget interaction:",t)}}const yt=20,wt=2;function m(t,e={}){const{size:o=yt,strokeWidth:n=wt,className:i=""}=e;return`
    <svg 
      class="np-icon ${i}" 
      width="${o}" 
      height="${o}" 
      viewBox="0 0 24 24" 
      fill="none" 
      stroke="currentColor" 
      stroke-width="${n}" 
      stroke-linecap="round" 
      stroke-linejoin="round"
    >
      ${t}
    </svg>
  `.trim()}const y={close:t=>m('<path d="M18 6 6 18"/><path d="m6 6 12 12"/>',t),menu:t=>m('<circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/>',t),send:t=>m('<path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/>',t),bell:t=>m('<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>',t),bellOff:t=>m('<path d="M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5"/><path d="M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/><path d="m2 2 20 20"/>',t),refresh:t=>m('<path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/>',t),download:t=>m('<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>',t),whatsapp:t=>m('<path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>',t),message:t=>m('<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>',t),user:t=>m('<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',t),bot:t=>m('<path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>',t),typing:t=>m('<circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/>',t),check:t=>m('<path d="M20 6 9 17l-5-5"/>',t),info:t=>m('<circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>',t),alertCircle:t=>m('<circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/>',t)};function vt(t){const e=l(),o=b(),n=o.locale==="ar",i=x(),r=Et(e.quickActions,i.pageType),a=n?e.greetingAr:e.greetingEn,s=n?"ŸÇÿØ ŸäŸÜÿ™ÿ¨ ÿßŸÑŸÄAI ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ∫Ÿäÿ± ÿØŸÇŸäŸÇÿ©. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©.":"AI may produce inaccurate information. Verify important information.",c=n?"ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉŸä":"AI Assistant";return`
    <div class="welcome-screen" data-welcome-screen>
      <div class="welcome-content">
        <!-- Header -->
        <div class="welcome-header">
          <div class="welcome-header-info">
            <h2 class="welcome-bot-name">${e.botName}</h2>
            <span class="welcome-ai-badge">${c}</span>
          </div>
          <button class="welcome-close-btn" data-welcome-close aria-label="Close">
            ${y.close({size:20})}
          </button>
        </div>
        
        <!-- Greeting Section -->
        <div class="welcome-greeting">
          <div class="welcome-avatar">
            ${e.botAvatar?`<img src="${e.botAvatar}" alt="${e.botName}" class="welcome-avatar-img" />`:`<div class="welcome-avatar-default">${y.bot({size:32,strokeWidth:1.5})}</div>`}
          </div>
          <p class="welcome-message">${a}</p>
        </div>
        
        <!-- Quick Actions -->
        ${r.length>0?`
          <div class="welcome-quick-actions">
            <h3 class="welcome-quick-actions-title">${n?"ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉÿü":"How can I help you?"}</h3>
            <div class="welcome-quick-actions-list">
              ${r.map(d=>xt(d,n)).join("")}
            </div>
          </div>
        `:""}
        
        <!-- Input Area -->
        <div class="welcome-input-area">
          <div class="welcome-input-wrapper">
            <textarea 
              class="welcome-input" 
              placeholder="${n?"ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß...":"Type your message here..."}"
              rows="1"
              data-welcome-input
            ></textarea>
            <button class="welcome-send-btn" data-welcome-send aria-label="${n?"ÿ•ÿ±ÿ≥ÿßŸÑ":"Send"}" disabled>
              <span>${o.direction==="rtl"?"‚Üê":"‚Üí"}</span>
            </button>
          </div>
        </div>
        
        <!-- Disclaimer -->
        <div class="welcome-disclaimer">
          ${s}
        </div>
      </div>
    </div>
  `}function xt(t,e){const o=e?t.titleAr:t.titleEn,n=t.icon||"‚Üí";return`
    <button 
      class="quick-action-btn" 
      data-quick-action="${t.id}"
      data-message-ar="${ye(t.messageAr)}"
      data-message-en="${ye(t.messageEn)}"
    >
      <span class="quick-action-icon">${n}</span>
      <span class="quick-action-title">${o}</span>
      <span class="quick-action-arrow">‚Ä∫</span>
    </button>
  `}function Et(t,e){return t.filter(o=>o.enabled?o.showOnPages.includes("all")?!0:o.showOnPages.includes(e):!1).sort((o,n)=>o.sortOrder-n.sortOrder)}function ye(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function kt(t,e){const o=l();b().locale;const i=t.querySelector("[data-welcome-close]");i==null||i.addEventListener("click",()=>{e.onClose()}),t.querySelectorAll("[data-quick-action]").forEach(c=>{c.addEventListener("click",()=>{const d=c.getAttribute("data-quick-action"),p=o.quickActions.find(L=>L.id===d);p&&e.onQuickAction(p)})});const a=t.querySelector("[data-welcome-input]"),s=t.querySelector("[data-welcome-send]");a&&s&&(a.addEventListener("input",()=>{a.style.height="auto",a.style.height=Math.min(a.scrollHeight,100)+"px",s.disabled=a.value.trim().length===0}),a.addEventListener("keydown",c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),a.value.trim()&&we(a,e))}),s.addEventListener("click",()=>{a.value.trim()&&we(a,e)}))}function we(t,e){const o=t.value.trim();if(!o)return;const n={id:"custom_message",enabled:!0,titleAr:o,titleEn:o,messageAr:o,messageEn:o,showOnPages:["all"],sortOrder:999};e.onQuickAction(n)}function Tt(t){const{suggestions:e,locale:o}=t,n=l();if(!n.suggestions.enabled||e.length===0)return"";const i=o==="ar",r=n.suggestions.style;return`
    <div class="follow-up-suggestions" data-suggestions-container>
      ${e.map((a,s)=>{const c=i?a.labelAr:a.labelEn;return`
          <button 
            class="suggestion-${r}" 
            data-suggestion-id="${a.id}"
            data-suggestion-index="${s}"
            aria-label="${ve(c)}"
            tabindex="0"
          >
            <span class="suggestion-label">${ve(c)}</span>
          </button>
        `}).join("")}
    </div>
  `}function St(t,e,o){t.querySelectorAll("[data-suggestion-id]").forEach(i=>{const r=i.getAttribute("data-suggestion-id"),a=e.find(s=>s.id===r);a&&(i.addEventListener("click",()=>{o.onPick(a)}),i.addEventListener("keydown",s=>{const c=s;(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),o.onPick(a))}))})}function Ct(t,e){const{pageType:o,lastEvent:n,maxVisible:i}=e;let r=t.filter(a=>a.enabled);if(r=r.filter(a=>a.showOnPages.includes("all")?!0:a.showOnPages.includes(o)),n){const a=r.filter(s=>!s.whenEvents||s.whenEvents.length===0?!0:s.whenEvents.includes(n));a.length>0&&(r=a)}return r.sort((a,s)=>s.priority!==a.priority?s.priority-a.priority:a.sortOrder-s.sortOrder),r.slice(0,i)}function ve(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Dt(t){const e=document.createElement("span");e.className="np-switch",e.setAttribute("role","switch"),e.setAttribute("aria-checked",t.checked.toString()),e.setAttribute("tabindex",t.disabled?"-1":"0"),t.ariaLabel&&e.setAttribute("aria-label",t.ariaLabel),t.disabled&&(e.setAttribute("aria-disabled","true"),e.classList.add("disabled"));const o=document.createElement("span");o.className="np-switch-track",t.checked&&o.classList.add("checked");const n=document.createElement("span");n.className="np-switch-thumb",o.appendChild(n),e.appendChild(o);const i=a=>{if(a.preventDefault(),a.stopPropagation(),t.disabled)return;const s=!t.checked;Q(e,s)},r=a=>{if(!t.disabled&&(a.key===" "||a.key==="Enter")){a.preventDefault();const s=!t.checked;Q(e,s)}};return e.addEventListener("click",i),e.addEventListener("keydown",r),e}function Q(t,e){const o=t.querySelector(".np-switch-track");o&&(t.setAttribute("aria-checked",e.toString()),e?o.classList.add("checked"):o.classList.remove("checked"))}function J(t){const e=document.createElement("button");return e.className="widget-menu-item",e.setAttribute("role","menuitem"),e.setAttribute("type","button"),t.disabled&&(e.setAttribute("disabled","true"),e.classList.add("disabled")),e.innerHTML=`
    <span class="menu-item-icon">${t.icon}</span>
    <span class="menu-item-label">${t.label}</span>
    ${t.showChevron?'<span class="menu-item-chevron">‚Ä∫</span>':""}
  `,e.addEventListener("click",o=>{o.preventDefault(),t.disabled||t.onClick()}),e}function At(t){const e=document.createElement("button");e.className="widget-menu-item widget-menu-toggle",e.setAttribute("role","menuitemcheckbox"),e.setAttribute("aria-checked",t.checked.toString()),e.setAttribute("type","button"),t.disabled&&(e.setAttribute("disabled","true"),e.classList.add("disabled"));const o=document.createElement("span");o.className="menu-item-icon",o.innerHTML=t.icon;const n=document.createElement("span");n.className="menu-item-label",n.textContent=t.label;const i=Dt({checked:t.checked,disabled:t.disabled,ariaLabel:t.label}),r=document.createElement("span");return r.className="menu-item-toggle",r.appendChild(i),e.appendChild(o),e.appendChild(n),e.appendChild(r),e.addEventListener("click",a=>{if(a.preventDefault(),!t.disabled){const s=!t.checked;e.setAttribute("aria-checked",s.toString()),Q(i,s),t.onChange(s)}}),e}function Mt(){const t=document.createElement("div");return t.className="widget-menu-divider",t.setAttribute("role","separator"),t}function _t(t,e){const o=Array.from(t.querySelectorAll(".widget-menu-item:not([disabled])"));if(o.length===0)return;let n=0;const i=r=>{r>=0&&r<o.length&&(o[r].focus(),n=r)};t.addEventListener("keydown",r=>{switch(r.key){case"ArrowDown":r.preventDefault(),i((n+1)%o.length);break;case"ArrowUp":r.preventDefault(),i((n-1+o.length)%o.length);break;case"Home":r.preventDefault(),i(0);break;case"End":r.preventDefault(),i(o.length-1);break;case"Escape":r.preventDefault(),e();break;case"Tab":r.shiftKey?n===0&&(r.preventDefault(),i(o.length-1)):n===o.length-1&&(r.preventDefault(),i(0));break}}),i(0)}function It(t,e,o){const n=i=>{const r=i.target;!t.contains(r)&&!e.contains(r)&&o()};return setTimeout(()=>{document.addEventListener("click",n,!0)},0),()=>{document.removeEventListener("click",n,!0)}}function Pt(t){try{if(t.waMeUrl){let e=t.waMeUrl.trim();if(!e.startsWith("http://")&&!e.startsWith("https://")&&(e="https://"+e),!e.includes("wa.me")&&!e.includes("api.whatsapp.com"))return null;if(t.messageTemplate&&!e.includes("?text=")&&!e.includes("&text=")){const o=xe(t.messageTemplate),n=e.includes("?")?"&":"?";e=`${e}${n}text=${encodeURIComponent(o)}`}return e}if(t.phoneE164){const e=Ot(t.phoneE164);if(!e)return null;let o=`https://wa.me/${e}`;if(t.messageTemplate){const n=xe(t.messageTemplate);o=`${o}?text=${encodeURIComponent(n)}`}return o}return null}catch(e){return console.error("[WhatsApp] Error building URL:",e),null}}function Ot(t){try{const e=t.replace(/\D/g,"");return e.length<10||e.length>15?null:e}catch{return null}}function xe(t){const e=Rt();let o=t;return o=o.replace(/\{storeName\}/g,e.storeName),o=o.replace(/\{customerName\}/g,e.customerName||"Customer"),o=o.replace(/\{pageUrl\}/g,e.pageUrl),o=o.replace(/\{productName\}/g,e.productName||""),o=o.replace(/\{cartTotal\}/g,e.cartTotal||""),o=o.replace(/\{\w+\}/g,""),o.trim()}function Rt(){var n,i,r;const t=l(),e=x(),o={storeName:t.botName,pageUrl:window.location.href};return(n=e.customer)!=null&&n.firstName&&(o.customerName=e.customer.firstName),(i=e.currentProduct)!=null&&i.name&&(o.productName=e.currentProduct.name),(r=e.cartSummary)!=null&&r.total&&(o.cartTotal=e.cartSummary.total.toString()),o}const Lt=':host{position:fixed!important;top:0!important;left:0!important;width:0!important;height:0!important;pointer-events:none!important;z-index:2147483647!important;--np-primary: #6366f1;--np-primary-hover: #4f46e5;--np-accent: #8b5cf6;--np-bg: #ffffff;--np-surface: #f9fafb;--np-text: #111827;--np-text-muted: #6b7280;--np-muted: #d1d5db;--np-border: #e5e7eb;--primary-color: var(--np-primary);--primary-hover: var(--np-primary-hover);--bg-color: var(--np-bg);--text-color: var(--np-text);--text-muted: var(--np-text-muted);--border-color: var(--np-border);--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .05);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .1), 0 4px 6px -2px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, .1), 0 10px 10px -5px rgba(0, 0, 0, .04);--radius-sm: .375rem;--radius-md: .5rem;--radius-lg: .75rem;--radius-xl: 1rem;--radius-full: 9999px;--panel-width: 380px;--panel-height: 600px;--button-size: 60px;--transition-fast: .15s ease;--transition-normal: .25s ease;--z-button: 999999;--z-panel: 1000000;--z-overlay: 999998;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:host *{pointer-events:auto}*{box-sizing:border-box;margin:0;padding:0}:host([dir="rtl"]){direction:rtl}.chat-button{position:fixed!important;bottom:20px!important;bottom:calc(20px + env(safe-area-inset-bottom))!important;width:var(--button-size)!important;height:var(--button-size)!important;border-radius:var(--radius-full)!important;background:var(--primary-color)!important;color:#fff!important;border:none!important;cursor:pointer!important;box-shadow:0 4px 12px #00000026!important;display:flex!important;align-items:center!important;justify-content:center!important;font-size:24px!important;transition:transform var(--transition-normal),box-shadow var(--transition-normal);z-index:2147483647!important;-webkit-tap-highlight-color:transparent;opacity:1!important;visibility:visible!important}.chat-button:hover{transform:scale(1.05);box-shadow:var(--shadow-xl)}.chat-button:active{transform:scale(.95)}.chat-button.position-right{right:20px;right:calc(20px + env(safe-area-inset-right))}.chat-button.position-left{left:20px;left:calc(20px + env(safe-area-inset-left))}.chat-button-badge{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;border-radius:var(--radius-full);width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;border:2px solid white}.chat-panel{position:fixed;bottom:90px;width:var(--panel-width);height:var(--panel-height);max-height:calc(100vh - 120px);background:var(--bg-color);border-radius:var(--radius-xl);box-shadow:var(--shadow-xl);display:flex;flex-direction:column;overflow:hidden;opacity:0;transform:translateY(20px) scale(.95);pointer-events:none;transition:opacity var(--transition-normal),transform var(--transition-normal);z-index:var(--z-panel)}.chat-panel.position-right{right:20px}.chat-panel.position-left{left:20px}.chat-panel.open{opacity:1;transform:translateY(0) scale(1);pointer-events:auto}.chat-header{background:var(--primary-color);color:#fff;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.chat-header-title{display:flex;align-items:center;gap:10px;font-size:16px;font-weight:600}.chat-header-status{display:flex;align-items:center;gap:6px;font-size:12px;opacity:.9}.status-dot{width:8px;height:8px;border-radius:var(--radius-full);background:#22c55e;animation:pulse 2s infinite}.status-dot.offline{background:#ef4444;animation:none}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}.chat-header-actions{display:flex;gap:8px;position:relative}.icon-button{background:#fff3;border:none;border-radius:var(--radius-md);width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background var(--transition-fast);color:#fff}.icon-button:hover{background:#ffffff4d}.chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px;background:#f9fafb;scroll-behavior:smooth}.chat-messages::-webkit-scrollbar{width:6px}.chat-messages::-webkit-scrollbar-track{background:transparent}.chat-messages::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:var(--radius-full)}.chat-messages::-webkit-scrollbar-thumb:hover{background:#9ca3af}.message{display:flex;gap:10px;max-width:85%;animation:messageSlideIn var(--transition-normal)}@keyframes messageSlideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message.user{align-self:flex-end;flex-direction:row-reverse}.message-avatar{width:32px;height:32px;border-radius:var(--radius-full);background:var(--np-primary);color:#fff;display:flex;align-items:center;justify-content:center;flex-shrink:0}.message-avatar .message-avatar-icon,.message-avatar .np-icon{width:18px;height:18px}.message.user .message-avatar{background:#6b7280}.message-content{flex:1;display:flex;flex-direction:column;gap:4px}.message-bubble{background:#fff;padding:12px 16px;border-radius:var(--radius-lg);color:var(--text-color);line-height:1.5;box-shadow:var(--shadow-sm);word-wrap:break-word}.message.user .message-bubble{background:var(--primary-color);color:#fff}.message-time{font-size:11px;color:var(--text-muted);padding:0 4px}.quick-replies{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}.quick-reply-chip{background:#fff;border:1px solid var(--border-color);padding:8px 14px;border-radius:var(--radius-full);font-size:13px;color:var(--text-color);cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}.quick-reply-chip:hover{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}.typing-indicator{display:flex;gap:10px;max-width:85%;padding:12px 0}.typing-indicator .message-avatar{background:var(--primary-color)}.typing-dots{background:#fff;padding:12px 16px;border-radius:var(--radius-lg);display:flex;gap:4px;box-shadow:var(--shadow-sm)}.typing-dot{width:8px;height:8px;border-radius:var(--radius-full);background:var(--text-muted);animation:typingDot 1.4s infinite}.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}@keyframes typingDot{0%,60%,to{opacity:.3;transform:translateY(0)}30%{opacity:1;transform:translateY(-6px)}}.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px 20px;color:var(--text-muted);gap:12px}.empty-state-icon{font-size:48px;opacity:.5}.empty-state-text{font-size:14px;line-height:1.5}.error-message{background:#fee2e2;border:1px solid #fecaca;color:#991b1b;padding:12px 16px;border-radius:var(--radius-md);font-size:14px;display:flex;align-items:center;gap:10px}.retry-button{background:#dc2626;color:#fff;border:none;padding:6px 12px;border-radius:var(--radius-sm);font-size:13px;cursor:pointer;transition:background var(--transition-fast)}.retry-button:hover{background:#b91c1c}.chat-input-area{padding:16px 20px;background:#fff;border-top:1px solid var(--border-color);flex-shrink:0}.chat-input-wrapper{display:flex;gap:10px;align-items:flex-end}.chat-input{flex:1;border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:10px 14px;font-size:14px;line-height:1.5;resize:none;max-height:100px;font-family:inherit;transition:border-color var(--transition-fast)}.chat-input:focus{outline:none;border-color:var(--primary-color)}.chat-input::placeholder{color:var(--text-muted)}.send-button{background:var(--primary-color);color:#fff;border:none;border-radius:var(--radius-lg);width:42px;height:42px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:background var(--transition-fast)}.send-button:hover:not(:disabled){background:var(--primary-hover)}.send-button:disabled{opacity:.5;cursor:not-allowed}.chat-disclaimer{font-size:11px;color:var(--text-muted);text-align:center;margin-top:8px;line-height:1.4}@media (max-width: 768px){.chat-panel{bottom:0;left:0;right:0;width:100%;height:100%;height:100dvh;max-height:100vh;max-height:100dvh;border-radius:0;padding-bottom:env(safe-area-inset-bottom)}.chat-button{bottom:calc(20px + env(safe-area-inset-bottom));right:calc(20px + env(safe-area-inset-right))}.chat-input-area{padding-bottom:calc(16px + env(safe-area-inset-bottom))}}@media (prefers-reduced-motion: reduce){*{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}@media (prefers-contrast: high){.chat-button{border:2px solid white}.message-bubble{border:1px solid var(--border-color)}}button:focus-visible,.quick-reply-chip:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px}.chat-input:focus-visible{outline:2px solid var(--primary-color);outline-offset:-1px}:host([dir="rtl"]) .chat-button.position-right{right:auto;left:20px;left:calc(20px + env(safe-area-inset-left))}:host([dir="rtl"]) .chat-button.position-left{left:auto;right:20px;right:calc(20px + env(safe-area-inset-right))}:host([dir="rtl"]) .chat-panel.position-right{right:auto;left:20px}:host([dir="rtl"]) .chat-panel.position-left{left:auto;right:20px}:host([dir="rtl"]) .message.user{flex-direction:row-reverse}:host([dir="rtl"]) .message.assistant{flex-direction:row}.loading-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:#fffc;display:flex;align-items:center;justify-content:center;z-index:10}.spinner{width:40px;height:40px;border:3px solid var(--border-color);border-top-color:var(--primary-color);border-radius:var(--radius-full);animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.welcome-screen{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bg-color);display:flex;flex-direction:column;overflow:hidden;animation:fadeIn .3s ease}.welcome-content{display:flex;flex-direction:column;height:100%;overflow:hidden}.welcome-header{padding:20px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:flex-start;flex-shrink:0}.welcome-header-info{flex:1}.welcome-bot-name{font-size:18px;font-weight:700;color:var(--text-color);margin-bottom:4px}.welcome-ai-badge{display:inline-block;font-size:12px;font-weight:500;color:var(--primary-color);background:#6366f11a;padding:2px 8px;border-radius:var(--radius-sm)}.welcome-close-btn{width:32px;height:32px;border:none;background:transparent;color:var(--text-muted);border-radius:var(--radius-md);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:background var(--transition-fast)}.welcome-close-btn:hover{background:#0000000d;color:var(--text-color)}.welcome-greeting{padding:40px 20px 30px;text-align:center;flex-shrink:0}.welcome-avatar{width:80px;height:80px;margin:0 auto 20px;border-radius:var(--radius-full);overflow:hidden;background:linear-gradient(135deg,var(--primary-color),var(--primary-hover));display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-lg)}.welcome-avatar-img{width:100%;height:100%;object-fit:cover}.welcome-avatar-default{font-size:40px}.welcome-message{font-size:16px;line-height:1.6;color:var(--text-color);max-width:300px;margin:0 auto}.welcome-quick-actions{flex:1;overflow-y:auto;padding:0 20px 20px;min-height:0}.welcome-quick-actions-title{font-size:14px;font-weight:600;color:var(--text-muted);margin-bottom:12px;text-transform:uppercase;letter-spacing:.5px}.welcome-quick-actions-list{display:flex;flex-direction:column;gap:8px}.quick-action-btn{width:100%;padding:16px;background:var(--bg-color);border:1px solid var(--border-color);border-radius:var(--radius-lg);cursor:pointer;text-align:left;display:flex;align-items:center;gap:12px;transition:all var(--transition-fast);font-family:inherit;color:var(--text-color)}.quick-action-btn:hover{background:#6366f10d;border-color:var(--primary-color);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.quick-action-btn:active{transform:translateY(0)}.quick-action-icon{font-size:20px;flex-shrink:0;width:24px;text-align:center}.quick-action-title{flex:1;font-size:14px;font-weight:500;line-height:1.4}.quick-action-arrow{font-size:18px;color:var(--text-muted);flex-shrink:0;transition:transform var(--transition-fast)}.quick-action-btn:hover .quick-action-arrow{transform:translate(2px)}:host([dir="rtl"]) .quick-action-btn{text-align:right;flex-direction:row-reverse}:host([dir="rtl"]) .quick-action-btn:hover .quick-action-arrow{transform:translate(-2px)}.welcome-input-area{flex-shrink:0;padding:16px 20px 12px;border-top:1px solid var(--border-color);background:var(--bg-color)}.welcome-input-wrapper{display:flex;gap:8px;align-items:flex-end;background:#00000008;border-radius:var(--radius-lg);padding:8px}.welcome-input{flex:1;border:none;background:transparent;font-family:inherit;font-size:14px;color:var(--text-color);resize:none;outline:none;max-height:100px;min-height:24px;line-height:1.5;padding:4px 8px}.welcome-input::placeholder{color:var(--text-muted)}.welcome-send-btn{width:36px;height:36px;border:none;background:var(--primary-color);color:#fff;border-radius:var(--radius-md);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;transition:all var(--transition-fast)}.welcome-send-btn:hover:not(:disabled){background:var(--primary-hover);transform:scale(1.05)}.welcome-send-btn:active:not(:disabled){transform:scale(.95)}.welcome-send-btn:disabled{opacity:.4;cursor:not-allowed}.welcome-disclaimer{padding:8px 20px 16px;font-size:11px;color:var(--text-muted);text-align:center;line-height:1.4;flex-shrink:0}@keyframes fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.chat-panel[data-view=welcome] .chat-messages,.chat-panel[data-view=welcome] .chat-input-area,.chat-panel[data-view=chat] .welcome-screen{display:none}.follow-up-suggestions{display:flex;flex-wrap:wrap;gap:6px;padding:12px 14px;margin-top:4px;animation:slideUp .3s ease}.suggestion-chips{display:inline-flex;align-items:center;justify-content:center;padding:7px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;font-size:13px;font-weight:500;color:#374151;cursor:pointer;transition:all .15s ease;white-space:nowrap;-webkit-tap-highlight-color:transparent;line-height:1.3}.suggestion-chips:hover{background:#f9fafb;border-color:#6366f1;color:#6366f1;transform:translateY(-1px);box-shadow:0 2px 6px #00000014}.suggestion-chips:active{transform:translateY(0);box-shadow:0 1px 3px #0000001a}.suggestion-chips:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a}.suggestion-buttons{display:inline-flex;align-items:center;gap:6px;padding:10px 16px;background:linear-gradient(135deg,var(--primary-color),var(--primary-hover));border:none;border-radius:var(--radius-lg);font-size:14px;font-weight:600;color:#fff;cursor:pointer;transition:all var(--transition-fast);white-space:nowrap;box-shadow:var(--shadow-sm);-webkit-tap-highlight-color:transparent}.suggestion-buttons:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}.suggestion-buttons:active{transform:translateY(0);box-shadow:var(--shadow-sm)}.suggestion-buttons:focus{outline:none;box-shadow:0 0 0 3px #6366f14d,var(--shadow-md)}.suggestion-icon{display:none}.suggestion-label{line-height:1.3;font-weight:500}:host([dir="rtl"]) .follow-up-suggestions{direction:rtl}:host([dir="rtl"]) .suggestion-chips,:host([dir="rtl"]) .suggestion-buttons{flex-direction:row-reverse}@media (max-width: 420px){.follow-up-suggestions{gap:5px;padding:10px 12px}.suggestion-chips,.suggestion-buttons{font-size:12px;padding:6px 10px}.suggestion-icon{font-size:14px}}@keyframes slideUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.chat-panel.typing .follow-up-suggestions{opacity:.5;pointer-events:none}.menu-trigger{position:relative}.widget-menu{position:absolute;top:calc(100% + 4px);min-width:200px;background:#fff;border-radius:12px;box-shadow:0 8px 32px #00000026,0 4px 12px #0000001a;padding:6px 0;z-index:999999;opacity:0;transform:scale(.95) translateY(-4px);transform-origin:top right;transition:opacity .2s cubic-bezier(.4,0,.2,1),transform .2s cubic-bezier(.4,0,.2,1);pointer-events:none}.widget-menu.open{opacity:1;transform:scale(1) translateY(0);pointer-events:auto}.widget-menu.top-right{right:0}.widget-menu.top-left{left:0;transform-origin:top left}.widget-menu-item{display:flex;align-items:center;gap:12px;width:100%;padding:10px 14px;border:none;background:none;text-align:start;cursor:pointer;transition:background var(--transition-fast);color:var(--np-text);font-size:14px;font-family:inherit;border-radius:6px;margin:0 4px;width:calc(100% - 8px)}.widget-menu-item:hover:not(.disabled){background:var(--np-surface)}.widget-menu-item:focus{outline:none;background:var(--np-surface);box-shadow:0 0 0 2px #6366f11a}.widget-menu-item:active:not(.disabled){background:var(--np-border)}.widget-menu-item.disabled{opacity:.5;cursor:not-allowed}.menu-item-icon{flex-shrink:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;color:var(--np-text-muted)}.menu-item-icon .np-icon{width:18px;height:18px}.menu-item-label{flex:1;font-weight:500;color:var(--np-text)}.menu-item-chevron{font-size:16px;opacity:.6;flex-shrink:0}.np-switch{display:inline-flex;align-items:center;cursor:pointer;outline:none;flex-shrink:0}.np-switch:focus-visible .np-switch-track{box-shadow:0 0 0 3px #6366f133}.np-switch.disabled{opacity:.5;cursor:not-allowed}.np-switch-track{width:44px;height:24px;background:var(--np-muted, #d1d5db);border-radius:12px;position:relative;transition:all .18s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;padding:2px;box-shadow:inset 0 1px 3px #0000001a}.np-switch-track.checked{background:var(--np-primary, #6366f1);box-shadow:inset 0 1px 3px #6366f14d}.np-switch-thumb{width:20px;height:20px;background:#fff;border-radius:50%;transition:transform .18s cubic-bezier(.4,0,.2,1);box-shadow:0 2px 4px #00000026,0 1px 2px #0000001a;will-change:transform}.np-switch-track.checked .np-switch-thumb{transform:translate(20px)}:host([dir="rtl"]) .np-switch-track.checked .np-switch-thumb{transform:translate(-20px)}.np-icon{display:inline-block;vertical-align:middle;flex-shrink:0}.widget-menu-divider{height:1px;background:var(--np-border, #e5e7eb);margin:8px 0}:host([dir="rtl"]) .widget-menu.top-right{right:auto;left:0}:host([dir="rtl"]) .widget-menu.top-left{left:auto;right:0}:host([dir="rtl"]) .menu-item-chevron{transform:scaleX(-1)}:host([dir="rtl"]) .toggle-track.on .toggle-thumb{transform:translate(-20px)}:host(.dark-mode) .widget-menu{background:#1f2937;box-shadow:0 4px 24px #0006,0 2px 8px #0000004d}:host(.dark-mode) .widget-menu-item{color:#f9fafb}:host(.dark-mode) .widget-menu-item:hover:not(.disabled){background:#374151}:host(.dark-mode) .widget-menu-item:focus{background:#4b5563}:host(.dark-mode) .widget-menu-item:active:not(.disabled){background:#374151}:host(.dark-mode) .widget-menu-divider{background:#374151}:host(.dark-mode) .toggle-track{background:#4b5563}.dialog-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:999999;opacity:0;transition:opacity .2s ease;pointer-events:none}.dialog-overlay.open{opacity:1;pointer-events:auto}.dialog-container{background:#fff;border-radius:16px;padding:24px;max-width:400px;width:90%;box-shadow:0 20px 60px #0000004d;transform:scale(.9);transition:transform .2s ease}.dialog-overlay.open .dialog-container{transform:scale(1)}.dialog-content{text-align:center}.dialog-icon{font-size:48px;margin-bottom:16px}.dialog-title{font-size:20px;font-weight:600;color:#1f2937;margin:0 0 12px}.dialog-message{font-size:14px;color:#6b7280;line-height:1.6;margin:0 0 24px}.dialog-actions{display:flex;gap:12px;justify-content:center}.dialog-btn{padding:10px 24px;border-radius:8px;border:none;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;font-family:inherit}.dialog-btn-cancel{background:#f3f4f6;color:#374151}.dialog-btn-cancel:hover{background:#e5e7eb}.dialog-btn-confirm{background:#ef4444;color:#fff}.dialog-btn-confirm:hover{background:#dc2626}.dialog-btn:active{transform:scale(.95)}@media (max-width: 480px){.widget-menu{min-width:200px;font-size:13px}.widget-menu-item{padding:10px 14px;gap:10px}.dialog-container{padding:20px;max-width:320px}.dialog-title{font-size:18px}.dialog-message{font-size:13px}.menu-item-icon{font-size:16px;width:20px}}';console.log("[ChatWidget Module] Loading ChatWidget.ts module..."),console.log("[ChatWidget Module] Imports complete, defining class...");const Ee="najdpulse_sound_enabled_";class I extends HTMLElement{constructor(){super(),this.isOpen=!1,this.currentView="closed",this.messages=[],this.isTyping=!1,this.container=null,this.messagesContainer=null,this.inputElement=null,this.buttonElement=null,this.panelElement=null,this.inactivityDetector=null,this.lastSuggestionsMessageId=null,this.config=l(),this.isRTL=!1,this.isMenuOpen=!1,this.menuElement=null,this.menuCleanup=null,this.shadow=this.attachShadow({mode:"open"}),console.log("[ChatWidget] Constructor called")}connectedCallback(){console.log("[ChatWidget] Connected to DOM, starting render..."),this.render(),this.attachEventListeners(),this.initializeAutoOpen(),console.log("[ChatWidget] ‚úÖ Widget fully mounted and visible")}disconnectedCallback(){this.removeEventListeners(),this.cleanupAutoOpen()}render(){const e=l(),o=b();this.isRTL=o.direction==="rtl";const n=e.position==="bottom-left"?"left":"right",i=document.createElement("style");i.textContent=`
      ${Lt}
      :host {
        --primary-color: ${e.primaryColor};
        --primary-hover: ${this.adjustColor(e.primaryColor,-20)};
      }
    `;const r=document.createElement("div");r.setAttribute("dir",this.isRTL?"rtl":"ltr"),r.setAttribute("lang",o.locale),r.innerHTML=`
      <button class="chat-button position-${n}" data-widget-launcher aria-label="${this.t("openChat")}" role="button">
        ${y.message({size:24,strokeWidth:2})}
      </button>
      
      <div class="chat-panel position-${n}" role="dialog" aria-modal="true" aria-labelledby="chat-title">
        <div class="chat-header">
          <div class="chat-header-title">
            <span id="chat-title">${e.botName}</span>
          </div>
          <div class="chat-header-actions">
            <button class="icon-button menu-trigger" aria-label="${this.t("menu")}" aria-haspopup="true" aria-expanded="false">
              <span>‚ãÆ</span>
            </button>
            <button class="icon-button close-button" aria-label="${this.t("closeChat")}">
              <span>‚úï</span>
            </button>
          </div>
        </div>
        
        <div class="chat-messages" role="log" aria-live="polite" aria-atomic="false">
          ${this.renderEmptyState()}
        </div>
        
        <div class="chat-input-area">
          <div class="chat-input-wrapper">
            <textarea 
              class="chat-input" 
              placeholder="${this.t("typePlaceholder")}"
              aria-label="${this.t("messageInput")}"
              rows="1"
            ></textarea>
            <button class="send-button" aria-label="${this.t("sendMessage")}" disabled>
              <span>${this.isRTL?"‚Üê":"‚Üí"}</span>
            </button>
          </div>
          <div class="chat-disclaimer">
            ${this.t("disclaimer")}
          </div>
        </div>
      </div>
    `,this.shadow.appendChild(i),this.shadow.appendChild(r),this.container=r,this.buttonElement=r.querySelector(".chat-button"),this.panelElement=r.querySelector(".chat-panel"),this.messagesContainer=r.querySelector(".chat-messages"),this.inputElement=r.querySelector(".chat-input")}attachEventListeners(){const e=this.shadow.querySelector(".chat-button"),o=this.shadow.querySelector(".close-button"),n=this.shadow.querySelector(".menu-trigger"),i=this.shadow.querySelector(".send-button"),r=this.shadow.querySelector(".chat-input");e==null||e.addEventListener("click",()=>this.togglePanel()),o==null||o.addEventListener("click",()=>this.closePanel()),n==null||n.addEventListener("click",a=>this.toggleMenu(a)),i==null||i.addEventListener("click",()=>this.handleSendMessage()),r&&(r.addEventListener("input",()=>this.handleInputChange()),r.addEventListener("keydown",a=>this.handleKeyDown(a))),window.addEventListener("najdpulse:auto-message",a=>{var c;const s=a;(c=s.detail)!=null&&c.message&&this.handleAutoMessage(s.detail.message)}),document.addEventListener("keydown",a=>{a.key==="Escape"&&this.isOpen&&this.closePanel()})}removeEventListeners(){}initializeAutoOpen(){const e=l(),o=x();if(!e.autoOpenEnabled){e.debugMode&&console.log("[AutoOpen] Auto-open disabled in config");return}if(e.quietModeInCheckout&&o.pageType==="checkout"){e.debugMode&&console.log("[AutoOpen] Skipping auto-open in checkout (quiet mode)");return}if(!mt()){e.debugMode&&console.log("[AutoOpen] Auto-open blocked (already shown or user interacted)");return}this.inactivityDetector=new pt(e.autoOpenDelayMs,()=>this.handleAutoOpen()),this.inactivityDetector.start(),e.debugMode&&console.log(`[AutoOpen] Started inactivity detector (${e.autoOpenDelayMs}ms)`)}handleAutoOpen(){l().debugMode&&console.log("[AutoOpen] Triggering auto-open"),ft(),this.openPanel("welcome")}cleanupAutoOpen(){this.inactivityDetector&&(this.inactivityDetector.destroy(),this.inactivityDetector=null)}togglePanel(){if(this.isOpen)this.closePanel();else{bt(),this.messages.length===0&&this.sendWelcomeMessage(),this.inactivityDetector&&this.inactivityDetector.stop();const o=l().showWelcomeOnLauncherTap&&this.messages.length===0;this.openPanel(o?"welcome":"chat")}}openPanel(e="chat"){var n,i,r;this.isOpen=!0,this.currentView=e,(n=this.panelElement)==null||n.classList.add("open"),(i=this.panelElement)==null||i.setAttribute("data-view",e),F(),e==="welcome"?this.renderWelcomeScreen():(r=this.inputElement)==null||r.focus(),l().debugMode&&console.log(`[Widget Debug] Panel opened with view: ${e}`)}closePanel(){var o,n;this.isOpen=!1,this.currentView="closed",(o=this.panelElement)==null||o.classList.remove("open"),(n=this.panelElement)==null||n.removeAttribute("data-view"),l().debugMode&&console.log("[Widget Debug] Panel closed")}switchToChatView(){var n,i,r;this.currentView="chat",(n=this.panelElement)==null||n.setAttribute("data-view","chat");const e=(i=this.panelElement)==null?void 0:i.querySelector(".welcome-screen");e==null||e.remove(),(r=this.inputElement)==null||r.focus(),l().debugMode&&console.log("[Widget Debug] Switched to chat view")}toggleMenu(e){e.stopPropagation(),this.isMenuOpen?this.closeMenu():this.openMenu()}openMenu(){const e=this.shadow.querySelector(".menu-trigger");e&&(this.closeMenu(),this.menuElement=this.createMenuElement(),e.appendChild(this.menuElement),_t(this.menuElement,()=>this.closeMenu()),this.menuCleanup=It(this.menuElement,e,()=>this.closeMenu()),this.isMenuOpen=!0,this.menuElement.classList.add("open"),e.setAttribute("aria-expanded","true"))}closeMenu(){this.menuElement&&(this.menuElement.classList.remove("open"),setTimeout(()=>{var o;(o=this.menuElement)==null||o.remove(),this.menuElement=null},150)),this.menuCleanup&&(this.menuCleanup(),this.menuCleanup=null);const e=this.shadow.querySelector(".menu-trigger");e&&e.setAttribute("aria-expanded","false"),this.isMenuOpen=!1}createMenuElement(){var p,L;const e=l(),n=b().locale==="ar",i=this.isRTL?"top-left":"top-right",r=document.createElement("div");r.className=`widget-menu ${i}`,r.setAttribute("role","menu");const a=this.getSoundEnabled(),s=At({icon:a?y.bell({size:18}):y.bellOff({size:18}),label:n?"ÿßŸÑÿµŸàÿ™":"Sound",checked:a,onChange:ee=>this.handleSoundToggle(ee)});r.appendChild(s);const c=J({icon:y.refresh({size:18}),label:n?"ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©":"Reset Chat",onClick:()=>{this.closeMenu(),this.showResetConfirmDialog()}});r.appendChild(c);const d=J({icon:y.download({size:18}),label:n?"ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©":"Export Chat",onClick:()=>{this.closeMenu(),this.handleExportChat()}});if(r.appendChild(d),(L=(p=e.contact)==null?void 0:p.whatsapp)!=null&&L.enabled&&e.contact.whatsapp.showInMenu!==!1){r.appendChild(Mt());const ee=J({icon:y.whatsapp({size:18}),label:n?"ŸÖÿ™ÿßÿ®ÿπÿ© ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®":"Continue on WhatsApp",showChevron:!0,onClick:()=>this.handleWhatsAppClick()});r.appendChild(ee)}return r}getSoundEnabled(){try{const e=Ee+this.config.storeId;return localStorage.getItem(e)!=="false"}catch{return!0}}handleSoundToggle(e){try{const o=Ee+this.config.storeId;localStorage.setItem(o,e.toString()),l().debugMode&&console.log("[Widget] Sound",e?"enabled":"disabled"),e&&this.playNotificationSound()}catch(o){console.error("[Widget] Error saving sound preference:",o)}}playNotificationSound(){try{if(typeof AudioContext<"u"||typeof window.webkitAudioContext<"u"){const e=window.AudioContext||window.webkitAudioContext,o=new e,n=o.createOscillator(),i=o.createGain();n.connect(i),i.connect(o.destination),n.frequency.value=800,n.type="sine",i.gain.setValueAtTime(.1,o.currentTime),i.gain.exponentialRampToValueAtTime(.01,o.currentTime+.1),n.start(o.currentTime),n.stop(o.currentTime+.1)}}catch{}}handleWhatsAppClick(){var a;const e=l(),o=(a=e.contact)==null?void 0:a.whatsapp;if(!(o!=null&&o.enabled))return;this.closeMenu();const i=b().locale==="ar",r=Pt({phoneE164:o.phoneE164,waMeUrl:o.waMeUrl,messageTemplate:o.defaultMessage||(i?"ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ÿ£ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ÿ®ÿÆÿµŸàÿµ {storeName}":"Hello, I need help regarding {storeName}")});r?(window.open(r,"_blank","noopener,noreferrer"),e.debugMode&&console.log("[Widget] WhatsApp handoff initiated")):console.error("[Widget] Failed to build WhatsApp URL")}handleResetChat(){this.messages=[],ct(),this.renderMessages(),this.sendWelcomeMessage(),l().debugMode&&console.log("[Widget Debug] Chat history cleared")}showResetConfirmDialog(){var a,s;const o=b().locale==="ar",n=document.createElement("div");n.className="dialog-overlay";const i=document.createElement("div");i.className="dialog-container",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.innerHTML=`
      <div class="dialog-content">
        <div class="dialog-icon">‚ö†Ô∏è</div>
        <h3 class="dialog-title">${o?"ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©":"Clear Chat"}</h3>
        <p class="dialog-message">
          ${o?"ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑÿü ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.":"Are you sure you want to delete all messages? This action cannot be undone."}
        </p>
        <div class="dialog-actions">
          <button class="dialog-btn dialog-btn-cancel" data-action="cancel">
            ${o?"ÿ•ŸÑÿ∫ÿßÿ°":"Cancel"}
          </button>
          <button class="dialog-btn dialog-btn-confirm" data-action="confirm">
            ${o?"ŸÖÿ≥ÿ≠":"Clear"}
          </button>
        </div>
      </div>
    `,n.appendChild(i),this.shadow.appendChild(n),requestAnimationFrame(()=>{n.classList.add("open")});const r=c=>{n.classList.remove("open"),setTimeout(()=>n.remove(),200),c==="confirm"&&this.handleResetChat()};(a=i.querySelector('[data-action="cancel"]'))==null||a.addEventListener("click",()=>r("cancel")),(s=i.querySelector('[data-action="confirm"]'))==null||s.addEventListener("click",()=>r("confirm")),n.addEventListener("click",c=>{c.target===n&&r("cancel")})}handleExportChat(){const o=b().locale==="ar";if(this.messages.length===0){alert(o?"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÑŸÑÿ™ÿµÿØŸäÿ±":"No messages to export");return}let n=`NajdPulse Chat Export
`;n+=`Date: ${new Date().toLocaleString()}
`,n+=`
${"=".repeat(50)}

`,this.messages.forEach(c=>{const d=c.role==="user"?o?"ÿ£ŸÜÿ™":"You":o?"ÿßŸÑŸÖÿ≥ÿßÿπÿØ":"Assistant",p=new Date(c.timestamp).toLocaleTimeString();n+=`[${p}] ${d}:
${c.content}

`});const i=new Blob([n],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=`najdpulse-chat-${Date.now()}.txt`,a.click(),URL.revokeObjectURL(r),l().debugMode&&console.log("[Widget] Chat exported")}renderWelcomeScreen(){if(!this.panelElement||this.panelElement.querySelector(".welcome-screen"))return;const e=vt();this.panelElement.insertAdjacentHTML("beforeend",e);const o=this.panelElement.querySelector(".welcome-screen");o&&kt(o,{onQuickAction:n=>this.handleQuickAction(n),onClose:()=>this.closePanel()})}async handleQuickAction(e){const o=b(),n=o.locale==="ar",i=n?e.messageAr:e.messageEn;this.switchToChatView(),this.addMessage({id:this.generateId(),role:"user",content:i,timestamp:Date.now()}),F(),this.showTyping();try{const r=await fe(i,o.locale,o.direction);this.hideTyping(),this.addMessage({id:this.generateId(),role:"assistant",content:r.assistantMessage,timestamp:Date.now(),quickReplies:r.quickReplies})}catch(r){this.hideTyping();const a=n?"ÿπÿ∞ÿ±ÿßŸãÿå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.":"Sorry, an error occurred. Please try again.";this.addMessage({id:this.generateId(),role:"assistant",content:a,timestamp:Date.now()}),l().debugMode&&console.error("[Widget Debug] Error handling quick action:",r)}}handleInputChange(){const e=this.inputElement,o=this.shadow.querySelector(".send-button");e&&o&&(e.style.height="auto",e.style.height=Math.min(e.scrollHeight,100)+"px",o.disabled=e.value.trim().length===0)}handleKeyDown(e){e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.handleSendMessage())}async handleSendMessage(){if(!this.inputElement)return;const e=this.inputElement.value.trim();if(e){this.inputElement.value="",this.handleInputChange(),this.addMessage({id:this.generateId(),role:"user",content:e,timestamp:Date.now()}),F(),this.showTyping();try{const o=b(),n=await fe(e,o.locale,o.direction);this.hideTyping(),this.addMessage({id:this.generateId(),role:"assistant",content:n.assistantMessage,timestamp:Date.now(),quickReplies:n.quickReplies})}catch(o){this.hideTyping();const i=b().locale==="ar";this.showError(i?"ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ´ÿßŸÜŸäÿ©.":"An error occurred. Please try again."),console.error("[Widget] Error sending message:",o)}}}sendWelcomeMessage(){const e=l(),o=x(),i=b().locale==="ar";let r=i?e.greetingAr:e.greetingEn,a=[];if(o.pageType)switch(o.pageType){case"home":r=i?"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü":"Welcome! How can I help you today?",a=i?["ÿßÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®","ŸáŸÑ ŸäŸàÿ¨ÿØ ÿÆÿµŸÖ ÿßŸà ÿπÿ±Ÿàÿ∂ ÿ≠ÿßŸÑŸäÿßŸãÿü","ŸÖÿß ŸáŸä ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπÿü"]:["I need help choosing a product","Any current offers or discounts?","Return policy"];break;case"product":r=i?"ÿ£ŸáŸÑÿßŸã! ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü":"Hi! Need information about this product?",a=i?["ŸÑÿÆÿµ ŸÑŸä ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨","ŸáŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖÿ™ŸàŸÅÿ±ÿü","ŸÖÿß ŸáŸä ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ•ÿ±ÿ¨ÿßÿπÿü"]:["Product summary","Is it available?","Return conditions"];break;case"category":r=i?"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®":"Hello! I can help you find the right product",a=i?["ÿßŸÇÿ™ÿ±ÿ≠ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜÿßÿ≥ÿ®ÿ©","ŸÖÿß ÿßŸÑŸÅÿ±ŸÇ ÿ®ŸäŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ÿü","ÿßŸÑÿ£ÿπŸÑŸâ ÿ™ŸÇŸäŸäŸÖÿßŸã"]:["Suggest products","Compare products","Top rated"];break;case"cart":r=i?"ŸáŸÑ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ≥ÿßÿπÿØÿ© ŸÖÿπ ÿ∑ŸÑÿ®ŸÉÿü":"Need help with your order?",a=i?["ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÉŸÖŸÑÿ©","ŸÉŸàÿØ ÿÆÿµŸÖ","ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ¥ÿ≠ŸÜ"]:["Add-ons","Discount code","Shipping info"];break}if(!r||r.trim()===""){console.warn("[ChatWidget] Skipping empty welcome message");return}this.addMessageWithTypingEffect({id:this.generateId(),role:"assistant",content:r,timestamp:Date.now(),quickReplies:a.length>0?a:void 0},20)}handleAutoMessage(e){l().debugMode&&console.log("[Widget] Received smart auto-message:",e),this.sendAutoMessage(e)}async sendAutoMessage(e,o){if(!lt()){l().debugMode&&console.log("[Widget Debug] Auto-message blocked by rate limit");return}if(this.messages.filter(n=>n.role==="user").length>0){l().debugMode&&console.log("[Widget Debug] Auto-message blocked - user is engaged");return}dt(),this.showTyping(),await new Promise(n=>setTimeout(n,1e3)),this.hideTyping(),this.addMessage({id:this.generateId(),role:"assistant",content:e,timestamp:Date.now(),quickReplies:o})}addMessage(e){this.messages.push(e),this.renderMessages()}async addMessageWithTypingEffect(e,o=30){this.showTyping(),await new Promise(a=>setTimeout(a,200)),this.hideTyping();const n={...e,content:""};this.messages.push(n),this.renderMessages();const i=this.messages.length-1,r=e.content;for(let a=0;a<=r.length;a++)this.messages[i].content=r.substring(0,a),this.renderMessages(),await new Promise(s=>setTimeout(s,o));this.messages[i]=e,this.renderMessages()}renderMessages(){if(!this.messagesContainer)return;const e=this.messages.map(o=>this.renderMessage(o)).join("");this.messagesContainer.innerHTML=e||this.renderEmptyState(),this.renderSuggestionsIfNeeded(),this.scrollToBottom(),this.attachQuickReplyListeners()}renderMessage(e){const o=e.role==="user",n=o?y.user({size:18,className:"message-avatar-icon"}):y.bot({size:18,className:"message-avatar-icon"}),i=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let r="";return e.quickReplies&&e.quickReplies.length>0&&(r=`
        <div class="quick-replies">
          ${e.quickReplies.map(a=>`
            <button class="quick-reply-chip" data-reply="${this.escapeHtml(a)}">
              ${this.escapeHtml(a)}
            </button>
          `).join("")}
        </div>
      `),`
      <div class="message ${o?"user":"assistant"}">
        <div class="message-avatar">${n}</div>
        <div class="message-content">
          <div class="message-bubble">${this.escapeHtml(e.content)}</div>
          ${r}
          <div class="message-time">${i}</div>
        </div>
      </div>
    `}renderEmptyState(){return`
      <div class="empty-state">
        <div class="empty-state-icon">${y.message({size:48,strokeWidth:1.5})}</div>
        <div class="empty-state-text">${this.t("emptyState")}</div>
      </div>
    `}renderNotConfiguredState(){const o=b().locale==="ar";return`
      <div class="empty-state">
        <div class="empty-state-icon">‚ö†Ô∏è</div>
        <div class="empty-state-text">
          ${o?"ÿßŸÑŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ∞ŸÉŸä ÿ∫Ÿäÿ± ŸÖŸÅÿπŸëŸÑ ÿ≠ÿßŸÑŸäÿßŸã. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿØÿßÿØ ŸÖŸÅÿ™ÿßÿ≠ OpenAI API.":"AI Assistant not configured. Please set up OpenAI API key."}
        </div>
        ${o?"<small>ÿ±ÿßÿ¨ÿπ ÿßŸÑÿ™Ÿàÿ´ŸäŸÇ ŸÑŸÖÿπÿ±ŸÅÿ© ŸÉŸäŸÅŸäÿ© ÿßŸÑÿ™ŸÅÿπŸäŸÑ.</small>":"<small>See documentation for setup instructions.</small>"}
      </div>
    `}showTyping(){if(!this.messagesContainer)return;this.isTyping=!0;const e=`
      <div class="typing-indicator">
        <div class="message-avatar">${y.bot({size:18,className:"message-avatar-icon"})}</div>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    `;this.messagesContainer.querySelector(".typing-indicator")||(this.messagesContainer.insertAdjacentHTML("beforeend",e),this.scrollToBottom())}hideTyping(){var o;this.isTyping=!1;const e=(o=this.messagesContainer)==null?void 0:o.querySelector(".typing-indicator");e==null||e.remove()}showError(e){if(!this.messagesContainer)return;const o=`
      <div class="error-message">
        <span>‚ö†Ô∏è ${this.escapeHtml(e)}</span>
        <button class="retry-button">${this.t("retry")}</button>
      </div>
    `;this.messagesContainer.insertAdjacentHTML("beforeend",o),this.scrollToBottom()}attachQuickReplyListeners(){this.shadow.querySelectorAll(".quick-reply-chip").forEach(o=>{o.addEventListener("click",n=>{const i=n.target.getAttribute("data-reply");i&&this.inputElement&&(this.inputElement.value=i,this.handleInputChange(),this.handleSendMessage())})})}renderSuggestionsIfNeeded(){var c,d;if(console.log("[Suggestions] Checking if suggestions should render..."),console.log("[Suggestions] messagesContainer:",!!this.messagesContainer),console.log("[Suggestions] config.suggestions:",this.config.suggestions),console.log("[Suggestions] enabled:",(c=this.config.suggestions)==null?void 0:c.enabled),!this.messagesContainer||!((d=this.config.suggestions)!=null&&d.enabled)){console.log("[Suggestions] Skipping: container or config missing");return}const e=[...this.messages].reverse().find(p=>p.role==="assistant"),o=this.messages.length===0||e;if(console.log("[Suggestions] Messages count:",this.messages.length),console.log("[Suggestions] Last assistant message:",e==null?void 0:e.id),console.log("[Suggestions] Should show:",o),!o){console.log("[Suggestions] Not showing: waiting for conditions");return}if(e&&this.lastSuggestionsMessageId===e.id){console.log("[Suggestions] Already rendered for this message");return}const n=this.messagesContainer.querySelector(".follow-up-suggestions");n&&(console.log("[Suggestions] Removing old suggestions"),n.remove());const i=this.getCurrentPageType(),r=[];console.log("[Suggestions] Page type:",i),console.log("[Suggestions] Current events:",r);const a=Ct(this.config.suggestions,i);if(console.log("[Suggestions] Selected suggestions:",a.length),a.length===0){console.log("[Suggestions] No suggestions to show");return}const s=Tt(a,this.isRTL);console.log("[Suggestions] Rendering HTML..."),this.messagesContainer.insertAdjacentHTML("beforeend",s),St(this.shadow,p=>this.handleSuggestionPick(p)),console.log("[Suggestions] ‚úÖ Suggestions rendered successfully"),this.lastSuggestionsMessageId=(e==null?void 0:e.id)||null}handleSuggestionPick(e){var i;const o=this.isRTL?e.messageAr:e.messageEn,n=(i=this.messagesContainer)==null?void 0:i.querySelector(".follow-up-suggestions");n&&n.remove(),this.lastSuggestionsMessageId=null,this.inputElement&&(this.inputElement.value=o,this.handleInputChange(),this.handleSendMessage())}getCurrentPageType(){const e=window.location.pathname.toLowerCase();return e.includes("/product")||e.includes("/item")?"product":e.includes("/cart")||e.includes("/checkout")?"cart":e.includes("/order")||e.includes("/track")?"order":e.includes("/about")||e.includes("/contact")?"about":e==="/"||e===""?"home":"other"}scrollToBottom(e=!0){this.messagesContainer&&requestAnimationFrame(()=>{this.messagesContainer&&(e?this.messagesContainer.scrollTo({top:this.messagesContainer.scrollHeight,behavior:"smooth"}):this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight)})}t(e){var r;const n=b().locale==="ar";return((r={openChat:{en:"Open chat",ar:"ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©"},closeChat:{en:"Close chat",ar:"ÿ£ÿ∫ŸÑŸÇ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©"},resetChat:{en:"Reset chat",ar:"ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©"},menu:{en:"Menu",ar:"ÿßŸÑŸÇÿßÿ¶ŸÖÿ©"},typePlaceholder:{en:"Type your message...",ar:"ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ..."},messageInput:{en:"Message input",ar:"ÿ≠ŸÇŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©"},sendMessage:{en:"Send message",ar:"ÿ£ÿ±ÿ≥ŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©"},disclaimer:{en:"AI assistant - responses may vary",ar:"ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉŸä - ŸÇÿØ ÿ™ÿÆÿ™ŸÑŸÅ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™"},emptyState:{en:"Start a conversation",ar:"ÿßÿ®ÿØÿ£ ŸÖÿ≠ÿßÿØÿ´ÿ©"},retry:{en:"Retry",ar:"ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©"}}[e])==null?void 0:r[n?"ar":"en"])||e}escapeHtml(e){const o=document.createElement("div");return o.textContent=e,o.innerHTML}generateId(){return`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}adjustColor(e,o){const n=parseInt(e.replace("#",""),16),i=Math.max(0,Math.min(255,(n>>16)+o)),r=Math.max(0,Math.min(255,(n>>8&255)+o)),a=Math.max(0,Math.min(255,(n&255)+o));return`#${(i<<16|r<<8|a).toString(16).padStart(6,"0")}`}}console.log("[ChatWidget Module] Class definition complete, about to register custom element..."),console.log("[ChatWidget Module] Checking if already registered:",customElements.get("salla-chat-widget")),customElements.get("salla-chat-widget")?console.log("[Widget] Custom element already registered"):(console.log("[Widget] Registering custom element: salla-chat-widget"),customElements.define("salla-chat-widget",I),console.log("[Widget] ‚úÖ Custom element registered"));let S=0;const Wt=I.prototype.connectedCallback;I.prototype.connectedCallback=function(){if(console.log("[Widget] üîó connectedCallback fired, current count:",S),S>0){console.warn("[Widget] ‚ö†Ô∏è Multiple widget instances detected. Removing duplicate."),this.remove();return}S++,console.log("[Widget] ‚úÖ Widget instance created, count:",S);try{Wt.call(this)}catch(t){throw console.error("[Widget] ‚ùå Error in connectedCallback:",t),t}},I.prototype.disconnectedCallback=function(){S--,console.log("[Widget] Widget disconnected, count:",S)};const Nt=100,Ut=5e3;function $t(t){const{onReady:e,onTimeout:o,debugMode:n=!1}=t;if(R()){n&&console.log("[Salla Guard] ‚úÖ Salla SDK already available");try{window.Salla.onReady(()=>{n&&console.log("[Salla Guard] ‚úÖ Salla.onReady callback fired"),e()})}catch(a){n&&console.warn("[Salla Guard] Error in Salla.onReady:",a),e()}return}n&&console.log("[Salla Guard] ‚è≥ Waiting for Salla SDK...");const i=Date.now(),r=()=>{if(R()){if(n){const s=Date.now()-i;console.log(`[Salla Guard] ‚úÖ Salla SDK detected after ${s}ms`)}try{window.Salla.onReady(()=>{n&&console.log("[Salla Guard] ‚úÖ Salla.onReady callback fired"),e()})}catch(s){n&&console.warn("[Salla Guard] Error in Salla.onReady:",s),e()}return}if(Date.now()-i>=Ut){n&&console.warn("[Salla Guard] ‚ö†Ô∏è Salla SDK not detected after 5 seconds - entering degraded mode"),o&&o(),e();return}setTimeout(r,Nt)};r()}function R(){try{return typeof window.Salla<"u"&&typeof window.Salla.onReady=="function"}catch{return!1}}function qt(t,e=!1){try{if(!R())return e&&console.warn("[Salla Guard] Cannot register tracker - Salla SDK not available"),!1;const o=window.Salla;return!o.analytics||typeof o.analytics.registerTracker!="function"?(e&&console.warn("[Salla Guard] Salla.analytics.registerTracker not available"),!1):(o.analytics.registerTracker(t),e&&console.log("[Salla Guard] ‚úÖ Tracker registered:",t.name),!0)}catch(o){return e&&console.warn("[Salla Guard] Error registering tracker:",o),!1}}g.HOME_VIEWED,g.PRODUCT_VIEWED,g.PRODUCT_LIST_VIEWED,g.PRODUCT_ADDED,g.PRODUCT_REMOVED,g.CART_VIEWED,g.CART_UPDATED,g.CHECKOUT_STARTED,g.SIGNED_IN,g.SIGNED_OUT,g.SIGNED_UP,g.USER_PROFILE_UPDATED;function Ht(){if(!l().debugMode)return;const e={emit(o,n){console.log("[Debug Bridge] Emitting event:",o,n);const i=z(o),r=f.get(i);if(!r){console.warn(`[Debug Bridge] No listener found for: "${o}" -> "${i}"`),console.log("[Debug Bridge] Available events:",Array.from(f.keys()));return}try{r(n||{}),console.log("[Debug Bridge] Event handled successfully")}catch(a){console.error(`[Debug Bridge] Error handling event ${o}:`,a)}},getContext(){return x()},setLocale(o){console.log("[Debug Bridge] Setting locale:",o),We(o)},setPageType(o){console.log("[Debug Bridge] Setting page type:",o),M(o)},listEvents(){return Array.from(f.keys())},health(){const o=l();return{version:window.__SALLA_TRACKER_VERSION__||"unknown",domain:A(),sallaAvailable:R(),snippetContext:D()?"present":"absent",config:{enabled:o.enabled,debugMode:o.debugMode,storeId:o.storeId||"not set",botName:o.botName,enabledPages:o.enabledPages}}}};window.__SALLA_TRACKER_DEBUG__=e,window.__SALLA_TRACKER_DEBUG__.SAMPLE_PAYLOADS=zt,console.log("[Debug Bridge] ‚úÖ Debug API exposed at window.__SALLA_TRACKER_DEBUG__"),console.log("[Debug Bridge] Available methods: emit, getContext, setLocale, setPageType, listEvents, health"),console.log("[Debug Bridge] Available events:",e.listEvents()),console.log("[Debug Bridge] Run health() for tracker status")}const zt={"product-viewed":{id:"test-product-123",name:"ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸÜÿ™ÿ¨ - Test Product",price:199.99,currency:"SAR",url:"/products/test-product-123",image_url:"https://example.com/product.jpg",category:"Electronics",brand:"Test Brand",sku:"TEST-SKU-123",quantity:1,in_stock:!0},"product-list-viewed":{category:{id:"cat-electronics",name:"ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ - Electronics",url:"/categories/electronics"},products:[{id:"p1",name:"ŸÖŸÜÿ™ÿ¨ 1 - Product 1",price:99.99,currency:"SAR"},{id:"p2",name:"ŸÖŸÜÿ™ÿ¨ 2 - Product 2",price:149.99,currency:"SAR"}],sort:"popular",filters:{}},"product-added":{id:"test-product-123",name:"ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸÜÿ™ÿ¨ - Test Product",price:199.99,currency:"SAR",quantity:1,cart_id:"cart-test-001"},"cart-viewed":{cart_id:"cart-test-001",items:[{id:"test-product-123",name:"ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸÜÿ™ÿ¨ - Test Product",price:199.99,currency:"SAR",quantity:1}],total:199.99,currency:"SAR",item_count:1},"cart-updated":{cart_id:"cart-test-001",items:[{id:"test-product-123",name:"ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸÜÿ™ÿ¨ - Test Product",price:199.99,currency:"SAR",quantity:2}],total:399.98,currency:"SAR",item_count:2,action:"add"},"checkout-started":{checkout_id:"checkout-test-001",cart_id:"cart-test-001",total:199.99,currency:"SAR",items:[{id:"test-product-123",name:"ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸÜÿ™ÿ¨ - Test Product",price:199.99,currency:"SAR",quantity:1}]},"signed-in":{customer_id:"customer-test-001",id:"customer-test-001",first_name:"ÿ£ÿ≠ŸÖÿØ",name:"ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ",email:"test@example.com"},"signed-out":{customer_id:null},"signed-up":{customer_id:"customer-new-001",id:"customer-new-001",first_name:"ŸÅÿßÿ∑ŸÖÿ©",name:"ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä",email:"newuser@example.com"},"user-profile-updated":{customer_id:"customer-test-001",id:"customer-test-001",first_name:"ÿ£ÿ≠ŸÖÿØ ÿßŸÑŸÖÿ≠ÿØÿ´",name:"ÿ£ÿ≠ŸÖÿØ ÿßŸÑŸÖÿ≠ÿØÿ´",email:"updated@example.com",preferences:{language:"ar",notifications:!0}},"home-viewed":{page:"home",url:"/",title:"ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - Home Page"}};function Vt(t){const e={enabled:!0,domain:window.location.hostname,styling:{primaryColor:"#6366F1",accentColor:"#10B981",themeMode:"auto"},identity:{botName:"ŸÖÿ≥ÿßÿπÿØ ÿßŸÑŸÖÿ™ÿ¨ÿ±",greetingAr:"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü",greetingEn:"Hello! How can I help you today?",tone:"balanced"},behavior:{position:"bottom-right",enabledPages:["home","product","category","cart"],quietModeCheckout:!0,autoOpenDelayMs:6e3,cooldownMs:25e3}};return!t||typeof t!="object"?e:"widgetSettings"in t||"botConfig"in t?jt(t,e):Kt(t,e)}function jt(t,e){const o={...e};if(typeof t.enabled=="boolean"&&(o.enabled=t.enabled),t.merchantId&&(o.merchantId=t.merchantId),t.storeId&&(o.storeId=t.storeId),t.domain&&(o.domain=t.domain),t.widgetSettings){const n=t.widgetSettings;n.primaryColor&&(o.styling.primaryColor=n.primaryColor),n.accentColor&&(o.styling.accentColor=n.accentColor),n.position&&(o.behavior.position=n.position),n.autoOpenDelayMs!==void 0&&(o.behavior.autoOpenDelayMs=n.autoOpenDelayMs),n.showOnPages&&Array.isArray(n.showOnPages)&&(n.showOnPages.includes("all")?o.behavior.enabledPages=["home","product","category","cart","checkout","other"]:o.behavior.enabledPages=n.showOnPages)}if(t.botConfig){const n=t.botConfig;n.name&&(o.identity.botName=n.name),n.avatarUrl&&(o.identity.avatarUrl=n.avatarUrl),n.tone&&(o.identity.tone=n.tone),n.greetings&&(n.greetings.ar&&(o.identity.greetingAr=n.greetings.ar),n.greetings.en&&(o.identity.greetingEn=n.greetings.en))}return o}function Kt(t,e){const o={...e};return typeof t.enabled=="boolean"&&(o.enabled=t.enabled),t.merchantId&&(o.merchantId=t.merchantId),t.storeId&&(o.storeId=t.storeId),t.domain&&(o.domain=t.domain),t.styling&&(t.styling.primaryColor&&(o.styling.primaryColor=t.styling.primaryColor),t.styling.accentColor&&(o.styling.accentColor=t.styling.accentColor),t.styling.themeMode&&(o.styling.themeMode=t.styling.themeMode)),t.identity&&(t.identity.botName&&(o.identity.botName=t.identity.botName),t.identity.avatarUrl&&(o.identity.avatarUrl=t.identity.avatarUrl),t.identity.greetingAr&&(o.identity.greetingAr=t.identity.greetingAr),t.identity.greetingEn&&(o.identity.greetingEn=t.identity.greetingEn),t.identity.tone&&(o.identity.tone=t.identity.tone)),t.behavior&&(t.behavior.position&&(o.behavior.position=t.behavior.position),t.behavior.enabledPages&&(t.behavior.enabledPages.includes("all")?o.behavior.enabledPages=["home","product","category","cart","checkout","other"]:o.behavior.enabledPages=t.behavior.enabledPages),typeof t.behavior.quietModeCheckout=="boolean"&&(o.behavior.quietModeCheckout=t.behavior.quietModeCheckout),t.behavior.autoOpenDelayMs!==void 0&&(o.behavior.autoOpenDelayMs=t.behavior.autoOpenDelayMs),t.behavior.cooldownMs!==void 0&&(o.behavior.cooldownMs=t.behavior.cooldownMs)),o}function Gt(t){const e=window.location.pathname.toLowerCase();return!(window.location.href.toLowerCase().includes("checkout")||e.includes("checkout"))}const X="2.0.0";customElements.get("salla-chat-widget")?l().debugMode&&console.log("[Widget Init] Custom element already registered"):(l().debugMode&&console.log("[Widget Init] Registering custom element: salla-chat-widget"),customElements.define("salla-chat-widget",I)),Ae(),Ht();const Z=l();if(Z.debugMode){console.log("[Tracker] Version:",X),console.log("[Tracker] Domain:",A());const t=D();console.log("[Tracker] Snippet context:",t?"Available":"Not provided")}async function ke(t){const e=l();e.debugMode&&(console.log("[Tracker] Initializing widget..."),console.log("[Tracker] Salla SDK available:",t)),t?!qt({name:"StoreEventsTracker",track:(a,s)=>{const c=z(a),d=f.get(c);if(e.debugMode&&console.log(`[Tracker] Event: "${a}" -> Key: "${c}"`,d?"‚úì":"‚úó"),!d){e.debugMode&&console.warn(`[Tracker] No handler for: ${c}`);return}try{d(s)}catch(p){console.error(`[Tracker] Error handling ${c}:`,p)}},page:a=>{e.debugMode&&console.log("[Tracker] Page event:",a)}},e.debugMode)&&e.debugMode&&console.warn("[Tracker] ‚ö†Ô∏è Failed to register tracker with Salla"):e.debugMode&&console.warn("[Tracker] ‚ö†Ô∏è Running in degraded mode without Salla SDK"),Ne();let o=null;try{const r=e.apiBaseUrl||window.__NAJDPULSE_API_URL__||"",a=A();e.debugMode&&console.log("[Tracker] Fetching config for domain:",a);const s=await tt(r,e.debugMode);if(s&&s.enabled){const c=Vt(s),{transformBotConfig:d}=await Promise.resolve().then(()=>Se),p=d(s,r,e.debugMode);Me(p),o={primaryColor:p.primaryColor,accentColor:p.accentColor,botName:p.botName},e.debugMode&&console.log("[Tracker] ‚úÖ Config loaded from API")}else e.debugMode&&console.log("[Tracker] Widget not enabled or store not configured - using defaults")}catch(r){e.debugMode&&console.log("[Tracker] Config fetch failed, using defaults:",r)}const n=l();e.debugMode&&(console.log("[Tracker] Widget enabled:",n.enabled),console.log("[Tracker] Enabled pages:",n.enabledPages));const i=Gt(n.enabledPages);if(e.debugMode&&console.log("[Tracker] Should show on current page:",i),n.enabled&&i)try{e.debugMode&&console.log("[Tracker] Creating widget element...");const r=document.createElement("salla-chat-widget");document.body.appendChild(r),Ke(r),o&&(ot(r,o,e.debugMode),e.debugMode&&console.log("[Tracker] ‚úÖ Branding applied")),e.debugMode&&console.log("[Tracker] ‚úÖ Widget initialized successfully")}catch(r){console.error("[Tracker] ‚ùå Error initializing widget:",r)}else e.debugMode&&(n.enabled?console.log("[Tracker] Widget hidden on this page type"):console.log("[Tracker] Widget is disabled in config"))}$t({onReady:()=>{ke(!0)},onTimeout:()=>{l().debugMode&&console.warn("[Tracker] ‚ö†Ô∏è Continuing in degraded mode (no Salla SDK)"),ke(!1)},debugMode:Z.debugMode}),Z.debugMode&&(window.__SALLA_TRACKER_VERSION__=X),k.TRACKER_VERSION=X,Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});
